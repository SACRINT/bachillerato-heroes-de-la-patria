<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard Administrativo del Bachillerato General Estatal H√©roes de la Patria">
    <meta name="keywords" content="administraci√≥n, dashboard, gesti√≥n, acad√©mico, control">
    <title>Dashboard Administrativo | BGE H√©roes de la Patria</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">

    <!-- CSS adicional para m√©tricas avanzadas -->
    <style>
        .timeline {
            position: relative;
            padding-left: 20px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #dee2e6;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 15px;
        }
        .timeline-marker {
            position: absolute;
            left: -16px;
            top: 2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border: 2px solid white;
        }
        .timeline-content {
            margin-left: 0;
        }
    </style>
</head>
<body>
    <!-- üîí PROTECCI√ìN JWT - VERIFICA AUTENTICACI√ìN ANTES DE CARGAR CONTENIDO -->
    <script>
        (function() {
            'use strict';
            console.log('üîí [DASHBOARD AUTH] Verificaci√≥n unificada de autenticaci√≥n...');

            function isAuthenticated() {
                // Verificar sistema JWT (primary)
                const token = localStorage.getItem('authToken');
                const userData = localStorage.getItem('userData');

                if (token && userData) {
                    try {
                        const user = JSON.parse(userData);
                        if (user && user.role === 'admin') {
                            console.log('‚úÖ [DASHBOARD AUTH] Sistema JWT v√°lido');
                            return true;
                        }
                    } catch (e) {
                        console.warn('‚ö†Ô∏è [DASHBOARD AUTH] Error en JWT:', e);
                    }
                }

                // Verificar sistema secure_admin_session (secondary)
                const secureSession = localStorage.getItem('secure_admin_session');
                if (secureSession) {
                    try {
                        const sessionData = JSON.parse(secureSession);
                        if (sessionData.isAuthenticated && sessionData.expiresAt && Date.now() < sessionData.expiresAt) {
                            console.log('‚úÖ [DASHBOARD AUTH] Sistema secure_admin_session v√°lido');
                            return true;
                        }
                    } catch (e) {
                        console.warn('‚ö†Ô∏è [DASHBOARD AUTH] Error en secure session:', e);
                    }
                }

                return false;
            }

            // Verificaci√≥n inmediata pero NO intrusiva
            if (!isAuthenticated()) {
                console.log('‚ùå [DASHBOARD AUTH] No autenticado - Redirigiendo...');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 100);
                return;
            }

            console.log('‚úÖ [DASHBOARD AUTH] Autenticaci√≥n confirmada - Cargando dashboard');
        })();
    </script>

    <!-- üßπ LIMPIEZA DE CACH√â Y SERVICE WORKER -->
    <script>
        (function() {
            'use strict';
            console.log('üßπ [CACHE CLEANER] Iniciando limpieza de cach√©...');

            // Limpiar service workers
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length > 0) {
                        console.log('üßπ [CACHE CLEANER] Service Workers encontrados:', registrations.length);
                        registrations.forEach(reg => {
                            reg.unregister();
                            console.log('üßπ [CACHE CLEANER] Service Worker desregistrado');
                        });
                    }
                });
            }

            // Limpiar cach√©s
            if ('caches' in window) {
                caches.keys().then(names => {
                    if (names.length > 0) {
                        console.log('üßπ [CACHE CLEANER] Cach√©s encontradas:', names.length);
                        names.forEach(name => {
                            caches.delete(name);
                            console.log('üßπ [CACHE CLEANER] Cach√© eliminada:', name);
                        });
                    }
                });
            }

            console.log('‚úÖ [CACHE CLEANER] Limpieza de cach√© completada');
        })();
    </script>

    <!-- Header -->
    <div id="main-header"></div>

    <!-- üîß Script para cargar header din√°micamente -->
    <script>
        (async function loadAdminHeader() {
            try {
                // Cargar header
                const response = await fetch('partials/header.html');
                if (!response.ok) throw new Error('Error al cargar header');

                const headerHTML = await response.text();
                document.getElementById('main-header').innerHTML = headerHTML;

                console.log('‚úÖ [ADMIN DASHBOARD] Header cargado correctamente');

                // Esperar a que bge-security-module est√© disponible y luego actualizar el estado
                // üîß OPTIMIZADO: Usar Promise con timeout en lugar de setInterval para evitar LAG
                const maxAttempts = 10; // Reducido de 20 a 10
                let attempts = 0;

                const checkModuleAvailability = () => {
                    return new Promise((resolve) => {
                        const checkOnce = () => {
                            attempts++;

                            if (typeof window.updateAdminHeaderStatus === 'function' && typeof window.secureAdminAuth !== 'undefined') {
                                // M√≥dulos disponibles
                                const isAuth = window.secureAdminAuth.isUserAuthenticated();
                                if (isAuth) {
                                    const user = window.secureAdminAuth.getCurrentUser();
                                    console.log('‚úÖ [ADMIN DASHBOARD] Sesi√≥n activa detectada, actualizando header:', user);
                                    window.updateAdminHeaderStatus(true, user);
                                } else {
                                    console.log('‚ÑπÔ∏è [ADMIN DASHBOARD] No hay sesi√≥n activa');
                                }
                                resolve(true);
                            } else if (attempts >= maxAttempts) {
                                // Timeout alcanzado
                                console.warn('‚ö†Ô∏è [ADMIN DASHBOARD] No se pudo actualizar el estado del header (timeout)', {
                                    updateAdminHeaderStatus: typeof window.updateAdminHeaderStatus,
                                    secureAdminAuth: typeof window.secureAdminAuth
                                });
                                resolve(false);
                            } else {
                                // Reintentar con delay progresivo (300ms, 600ms, 900ms, etc.)
                                setTimeout(checkOnce, 300 * attempts);
                            }
                        };
                        checkOnce();
                    });
                };

                checkModuleAvailability();

            } catch (error) {
                console.error('‚ùå [ADMIN DASHBOARD] Error cargando header:', error);
            }
        })();
    </script>

    <!-- Hero Section - Solo visible cuando no est√° logueado -->
    <section id="hero" class="page-hero bg-gradient-primary text-white py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-4">
                        <i class="fas fa-tachometer-alt me-3"></i>Dashboard Administrativo
                    </h1>
                    <p class="lead mb-4">
                        Panel de control integral para la gesti√≥n acad√©mica y administrativa 
                        del BGE H√©roes de la Patria.
                    </p>
                </div>
                <div class="col-lg-4 text-center">
                    <div class="hero-icon display-1 text-white-50">
                        <i class="fas fa-cog" aria-hidden="true"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Caracter√≠sticas del Dashboard -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5">
                    <h2 class="fw-bold text-dark" style="color: #212529 !important;">Caracter√≠sticas del Sistema</h2>
                    <p class="text-muted">Herramientas completas para la gesti√≥n escolar</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 border-0 shadow-sm feature-card" style="cursor: pointer; transition: transform 0.2s ease;" onclick="scrollToSection('adminPanel')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-chart-bar fa-3x text-primary"></i>
                            </div>
                            <h5 class="card-title">Gesti√≥n de Contenido</h5>
                            <p class="card-text text-muted">Administre noticias, eventos, avisos y contenido din√°mico del sitio</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 border-0 shadow-sm feature-card" style="cursor: pointer; transition: transform 0.2s ease;" onclick="showInfoModal()" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-info-circle fa-3x text-success"></i>
                            </div>
                            <h5 class="card-title">Informaci√≥n del Sistema</h5>
                            <p class="card-text text-muted">Conoce las caracter√≠sticas y capacidades del dashboard</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 border-0 shadow-sm feature-card" style="cursor: pointer; transition: transform 0.2s ease;" onclick="scrollToSection('modulos-admin')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-th-large fa-3x text-warning"></i>
                            </div>
                            <h5 class="card-title">M√≥dulos Administrativos</h5>
                            <p class="card-text text-muted">Explora los m√≥dulos disponibles del sistema</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 border-0 shadow-sm feature-card" style="cursor: pointer; transition: transform 0.2s ease;" onclick="scrollToSection('seguridad')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-shield-alt fa-3x text-info"></i>
                            </div>
                            <h5 class="card-title">Seguridad</h5>
                            <p class="card-text text-muted">Informaci√≥n sobre protecci√≥n y privacidad de datos</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Secci√≥n M√≥dulos Administrativos -->
    <section id="modulos-admin" class="py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5">
                    <h2 class="fw-bold">M√≥dulos Administrativos</h2>
                    <p class="text-muted">Herramientas especializadas para la gesti√≥n integral</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-users fa-3x text-primary"></i>
                            </div>
                            <h5 class="card-title">Gesti√≥n de Estudiantes</h5>
                            <p class="card-text text-muted">Control completo de matr√≠culas, expedientes acad√©micos, calificaciones y seguimiento estudiantil.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Registro y actualizaci√≥n de datos</li>
                                <li><i class="fas fa-check text-success me-2"></i>Historial acad√©mico completo</li>
                                <li><i class="fas fa-check text-success me-2"></i>Sistema de alertas acad√©micas</li>
                                <li><i class="fas fa-check text-success me-2"></i>Exportaci√≥n de reportes</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-chalkboard-teacher fa-3x text-success"></i>
                            </div>
                            <h5 class="card-title">Gesti√≥n de Docentes</h5>
                            <p class="card-text text-muted">Administraci√≥n del personal acad√©mico, asignaci√≥n de materias y control de carga horaria.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Perfil completo de docentes</li>
                                <li><i class="fas fa-check text-success me-2"></i>Asignaci√≥n de materias</li>
                                <li><i class="fas fa-check text-success me-2"></i>Control de horarios</li>
                                <li><i class="fas fa-check text-success me-2"></i>Evaluaci√≥n de desempe√±o</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-chart-bar fa-3x text-info"></i>
                            </div>
                            <h5 class="card-title">Reportes y Estad√≠sticas</h5>
                            <p class="card-text text-muted">Generaci√≥n de reportes acad√©micos, financieros y estad√≠sticas institucionales en tiempo real.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Reportes acad√©micos</li>
                                <li><i class="fas fa-check text-success me-2"></i>Estad√≠sticas de rendimiento</li>
                                <li><i class="fas fa-check text-success me-2"></i>Control financiero</li>
                                <li><i class="fas fa-check text-success me-2"></i>An√°lisis predictivo</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-dollar-sign fa-3x text-warning"></i>
                            </div>
                            <h5 class="card-title">Sistema de Pagos</h5>
                            <p class="card-text text-muted">Control integral de colegiaturas, pagos pendientes y estado financiero de estudiantes.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Registro de pagos</li>
                                <li><i class="fas fa-check text-success me-2"></i>Control de vencimientos</li>
                                <li><i class="fas fa-check text-success me-2"></i>Estados de cuenta</li>
                                <li><i class="fas fa-check text-success me-2"></i>Alertas autom√°ticas</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-calendar-alt fa-3x text-danger"></i>
                            </div>
                            <h5 class="card-title">Calendario Acad√©mico</h5>
                            <p class="card-text text-muted">Gesti√≥n completa del calendario escolar, eventos importantes y fechas acad√©micas.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Planificaci√≥n de eventos</li>
                                <li><i class="fas fa-check text-success me-2"></i>Fechas de ex√°menes</li>
                                <li><i class="fas fa-check text-success me-2"></i>Per√≠odos vacacionales</li>
                                <li><i class="fas fa-check text-success me-2"></i>Notificaciones autom√°ticas</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-bell fa-3x text-warning"></i>
                            </div>
                            <h5 class="card-title">Notificaciones Push</h5>
                            <p class="card-text text-muted">Sistema avanzado de notificaciones push para comunicaci√≥n efectiva con la comunidad educativa.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Comunicados oficiales</li>
                                <li><i class="fas fa-check text-success me-2"></i>Recordatorios acad√©micos</li>
                                <li><i class="fas fa-check text-success me-2"></i>Alertas de emergencia</li>
                                <li><i class="fas fa-check text-success me-2"></i>Notificaciones programadas</li>
                            </ul>
                            <button class="btn btn-warning btn-sm mt-2" onclick="openNotificationPanel()">
                                <i class="fas fa-bell me-2"></i>Gestionar Notificaciones
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-envelope-open-text fa-3x text-primary"></i>
                            </div>
                            <h5 class="card-title">Newsletters y Suscriptores</h5>
                            <p class="card-text text-muted">Sistema completo de newsletters para comunicaci√≥n masiva con suscriptores y comunidad educativa.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Gesti√≥n de suscriptores</li>
                                <li><i class="fas fa-check text-success me-2"></i>Env√≠o masivo de newsletters</li>
                                <li><i class="fas fa-check text-success me-2"></i>Editor visual de contenido</li>
                                <li><i class="fas fa-check text-success me-2"></i>Estad√≠sticas de env√≠o</li>
                            </ul>
                            <a href="/admin-newsletters.html" class="btn btn-primary btn-sm mt-2">
                                <i class="fas fa-paper-plane me-2"></i>Administrar Newsletters
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-calendar-check fa-3x text-info"></i>
                            </div>
                            <h5 class="card-title">Sistema de Citas</h5>
                            <p class="card-text text-muted">Administraci√≥n centralizada de citas agendadas por estudiantes, padres de familia y comunidad educativa.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Visualizar todas las citas</li>
                                <li><i class="fas fa-check text-success me-2"></i>Estad√≠sticas por departamento</li>
                                <li><i class="fas fa-check text-success me-2"></i>Exportar datos a CSV</li>
                                <li><i class="fas fa-check text-success me-2"></i>Gesti√≥n de citas activas</li>
                            </ul>
                            <a href="/admin-citas.html" class="btn btn-info btn-sm mt-2">
                                <i class="fas fa-calendar-alt me-2"></i>Administrar Citas
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-cog fa-3x text-secondary"></i>
                            </div>
                            <h5 class="card-title">Configuraci√≥n del Sistema</h5>
                            <p class="card-text text-muted">Configuraci√≥n avanzada de par√°metros institucionales y personalizaci√≥n del sistema.</p>
                            <ul class="list-unstyled small text-start">
                                <li><i class="fas fa-check text-success me-2"></i>Configuraci√≥n institucional</li>
                                <li><i class="fas fa-check text-success me-2"></i>Personalizaci√≥n de reportes</li>
                                <li><i class="fas fa-check text-success me-2"></i>Gesti√≥n de usuarios</li>
                                <li><i class="fas fa-check text-success me-2"></i>Respaldos autom√°ticos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Secci√≥n Seguridad -->
    <section id="seguridad" class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5">
                    <h2 class="fw-bold">
                        <i class="fas fa-shield-alt me-2 text-primary"></i>Seguridad del Sistema
                    </h2>
                    <p class="text-muted">Protecci√≥n integral de datos y privacidad institucional</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-lock me-2"></i>Medidas de Seguridad
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="text-primary">Autenticaci√≥n y Acceso</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Autenticaci√≥n Multifactor:</strong> Sistema de verificaci√≥n en dos pasos para acceso administrativo
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Roles y Permisos:</strong> Control granular de acceso seg√∫n el nivel administrativo
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Sesiones Seguras:</strong> Timeout autom√°tico y cifrado de sesiones activas
                                        </li>
                                    </ul>
                                    
                                    <h6 class="text-primary">Protecci√≥n de Datos</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Cifrado de Datos:</strong> Encriptaci√≥n AES-256 para informaci√≥n sensible
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Respaldos Autom√°ticos:</strong> Copias de seguridad diarias y semanales
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Auditor√≠a Completa:</strong> Registro de todas las acciones administrativas
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-user-shield me-2"></i>Privacidad y Cumplimiento
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="text-success">Normativas de Privacidad</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <i class="fas fa-gavel text-info me-2"></i>
                                            <strong>Ley Federal de Protecci√≥n de Datos:</strong> Cumplimiento total con normativas mexicanas
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-gavel text-info me-2"></i>
                                            <strong>LOPD Educativa:</strong> Protecci√≥n espec√≠fica de datos acad√©micos estudiantiles
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-gavel text-info me-2"></i>
                                            <strong>Derecho al Olvido:</strong> Eliminaci√≥n segura de datos seg√∫n solicitud
                                        </li>
                                    </ul>
                                    
                                    <h6 class="text-success">Monitoreo y Alertas</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <i class="fas fa-eye text-warning me-2"></i>
                                            <strong>Monitoreo 24/7:</strong> Supervisi√≥n continua del sistema
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-eye text-warning me-2"></i>
                                            <strong>Alertas de Seguridad:</strong> Notificaciones inmediatas ante actividad sospechosa
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-eye text-warning me-2"></i>
                                            <strong>An√°lisis de Comportamiento:</strong> Detecci√≥n de patrones an√≥malos de acceso
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Panel de Estado de Seguridad -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-line me-2"></i>Estado Actual de Seguridad
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="badge bg-success fs-6 p-3 rounded-circle mb-2">
                                            <i class="fas fa-shield-alt fa-2x"></i>
                                        </div>
                                        <h6 class="text-success">Sistema Protegido</h6>
                                        <small class="text-muted">Todas las medidas activas</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="badge bg-primary fs-6 p-3 rounded-circle mb-2">
                                            <i class="fas fa-users fa-2x"></i>
                                        </div>
                                        <h6 class="text-primary">4 Usuarios Activos</h6>
                                        <small class="text-muted">Personal autorizado</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="badge bg-warning fs-6 p-3 rounded-circle mb-2">
                                            <i class="fas fa-database fa-2x"></i>
                                        </div>
                                        <h6 class="text-warning">√öltimo Respaldo</h6>
                                        <small class="text-muted">Hace 2 horas</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="badge bg-info fs-6 p-3 rounded-circle mb-2">
                                            <i class="fas fa-clock fa-2x"></i>
                                        </div>
                                        <h6 class="text-info">Uptime: 99.8%</h6>
                                        <small class="text-muted">Disponibilidad del sistema</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Secci√≥n de M√©tricas Ejecutivas Avanzadas -->
    <section class="py-5 bg-light dashboard-section" id="executive-metrics-section" style="display: none;">
        <div class="container">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h2 class="h3 text-primary mb-2">
                                <i class="fas fa-chart-line me-3"></i>M√©tricas Ejecutivas Avanzadas
                            </h2>
                            <p class="text-muted mb-0">Dashboard en tiempo real con KPIs institucionales</p>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-primary btn-sm" onclick="advancedMetrics?.updateRealTimeMetrics()">
                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="advancedMetrics?.exportWidget('all')">
                                <i class="fas fa-download me-1"></i>Exportar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contenedor de Widgets Ejecutivos -->
            <div class="row" id="executive-widgets">
                <!-- Los widgets se generan din√°micamente aqu√≠ -->
            </div>

            <!-- Widgets de Analytics movidos dentro de pesta√±as -->

            <!-- Panel de Alertas y Notificaciones -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-transparent border-0 pb-0">
                            <h6 class="mb-0 text-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>Alertas del Sistema
                            </h6>
                        </div>
                        <div class="card-body pt-2">
                            <div class="alert alert-warning py-2 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-server text-warning me-2"></i>
                                    <small>Uso de servidor al 78% - Revisar capacidad</small>
                                </div>
                            </div>
                            <div class="alert alert-info py-2 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-database text-info me-2"></i>
                                    <small>Backup programado en 2 horas</small>
                                </div>
                            </div>
                            <div class="alert alert-success py-2 mb-0">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-shield-alt text-success me-2"></i>
                                    <small>Todos los sistemas de seguridad operativos</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-transparent border-0 pb-0">
                            <h6 class="mb-0 text-primary">
                                <i class="fas fa-clock me-2"></i>Actividad Reciente
                            </h6>
                        </div>
                        <div class="card-body pt-2">
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-marker bg-success"></div>
                                    <div class="timeline-content">
                                        <small class="text-muted">Hace 5 min</small>
                                        <p class="mb-0 small">Nuevo estudiante registrado</p>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-marker bg-info"></div>
                                    <div class="timeline-content">
                                        <small class="text-muted">Hace 15 min</small>
                                        <p class="mb-0 small">Actualizaci√≥n de calificaciones</p>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-marker bg-warning"></div>
                                    <div class="timeline-content">
                                        <small class="text-muted">Hace 1 hora</small>
                                        <p class="mb-0 small">Mantenimiento programado completado</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Login -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">
                        <i class="fas fa-shield-alt me-2"></i>Acceso Administrativo
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="adminLoginForm">
                        <div class="mb-3">
                            <label for="adminUsername" class="form-label">Usuario Administrativo</label>
                            <input type="text" class="form-control" id="adminUsername" placeholder="Nombre de usuario" autocomplete="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminPassword" class="form-label">Contrase√±a</label>
                            <input type="password" class="form-control" id="adminPassword" autocomplete="current-password" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminRole" class="form-label">Rol</label>
                            <select class="form-select" id="adminRole" required>
                                <option value="">Seleccionar rol</option>
                                <option value="director">Director</option>
                                <option value="subdirector">Subdirector</option>
                                <option value="coordinador">Coordinador Acad√©mico</option>
                                <option value="secretaria">Secretaria Acad√©mica</option>
                            </select>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Datos de prueba:</strong><br>
                            Usuario: admin<br>
                            Contrase√±a: admin123<br>
                            Rol: Director
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="loginAdmin()">
                        <i class="fas fa-sign-in-alt me-2"></i>Acceder
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Informaci√≥n -->
    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="infoModalLabel">
                        <i class="fas fa-info-circle me-2"></i>Informaci√≥n del Sistema
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Estad√≠sticas en Tiempo Real -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary">üìä Estad√≠sticas Institucionales (Tiempo Real)</h6>
                            <div class="row">
                                <div class="col-6 col-md-3">
                                    <div class="card bg-light border-0 text-center p-2">
                                        <div class="h5 text-success mb-0" id="modalTotalStudents">1,247</div>
                                        <small>Estudiantes</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="card bg-light border-0 text-center p-2">
                                        <div class="h5 text-info mb-0" id="modalTotalTeachers">68</div>
                                        <small>Docentes</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="card bg-light border-0 text-center p-2">
                                        <div class="h5 text-warning mb-0" id="modalTotalSubjects">42</div>
                                        <small>Materias</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="card bg-light border-0 text-center p-2">
                                        <div class="h5 text-danger mb-0" id="modalGeneralAverage">8.4</div>
                                        <small>Promedio</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estad√≠sticas del CMS -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-success">üìù Estad√≠sticas del Sistema de Contenidos (CMS)</h6>
                            <div class="row">
                                <div class="col-6 col-md-3">
                                    <div class="card bg-primary border-0 text-center p-2 text-white">
                                        <div class="h5 mb-0" id="modal-stat-noticias">0</div>
                                        <small>üì∞ Noticias</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="card bg-success border-0 text-center p-2 text-white">
                                        <div class="h5 mb-0" id="modal-stat-eventos">0</div>
                                        <small>üìÖ Eventos</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="card bg-warning border-0 text-center p-2 text-white">
                                        <div class="h5 mb-0" id="modal-stat-avisos">0</div>
                                        <small>‚ö†Ô∏è Avisos</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="card bg-info border-0 text-center p-2 text-white">
                                        <div class="h5 mb-0" id="modal-stat-comunicados">0</div>
                                        <small>üìã Comunicados</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12 text-center">
                                    <div class="alert alert-light">
                                        <strong>Informaci√≥n del Sistema:</strong><br>
                                        <small class="text-muted">
                                            √öltima actualizaci√≥n: <span id="last-update">Cargando...</span><br>
                                            Administrador actual: <span id="current-admin">Sistema CMS BGE</span><br>
                                            Tiempo de sesi√≥n: <span id="session-time">0 minutos</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sistema y Estado -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6>üè• Estado del Sistema</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-circle text-success me-2"></i><span id="systemStatus">Sistema Operativo</span></li>
                                <li><i class="fas fa-server text-info me-2"></i>Servidor: <span id="serverStatus">Online</span></li>
                                <li><i class="fas fa-database text-warning me-2"></i>Base de Datos: <span id="dbStatus">Conectada</span></li>
                                <li><i class="fas fa-wifi text-success me-2"></i>Conexi√≥n: <span id="connectionStatus">Estable</span></li>
                                <li><i class="fas fa-clock text-primary me-2"></i>√öltima Act.: <span id="lastUpdate">Ahora</span></li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>üë§ Informaci√≥n de Sesi√≥n</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-user text-primary me-2"></i>Usuario: <span id="currentUserName">Administrador</span></li>
                                <li><i class="fas fa-shield-alt text-success me-2"></i>Rol: <span id="currentUserRole">Director</span></li>
                                <li><i class="fas fa-calendar text-info me-2"></i>Login: <span id="loginTime">--</span></li>
                                <li><i class="fas fa-key text-warning me-2"></i>Sesi√≥n: <span id="sessionStatus">Activa</span></li>
                                <li><i class="fas fa-lock text-success me-2"></i>Seguridad: Habilitada</li>
                            </ul>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <h6>‚úÖ M√≥dulos Disponibles</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Gesti√≥n de Estudiantes</li>
                                <li><i class="fas fa-check text-success me-2"></i>Control Acad√©mico</li>
                                <li><i class="fas fa-check text-success me-2"></i>Reportes y Estad√≠sticas</li>
                                <li><i class="fas fa-check text-success me-2"></i>Sistema de Pagos</li>
                                <li><i class="fas fa-check text-success me-2"></i>Gesti√≥n de Personal</li>
                                <li><i class="fas fa-check text-success me-2"></i>Configuraci√≥n</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>üîß Caracter√≠sticas T√©cnicas</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-shield-alt text-primary me-2"></i>Seguridad avanzada</li>
                                <li><i class="fas fa-cloud text-info me-2"></i>Respaldo autom√°tico</li>
                                <li><i class="fas fa-mobile-alt text-success me-2"></i>Dise√±o responsivo</li>
                                <li><i class="fas fa-chart-bar text-warning me-2"></i>Dashboard interactivo</li>
                                <li><i class="fas fa-users text-secondary me-2"></i>Multi-usuario</li>
                                <li><i class="fas fa-clock text-danger me-2"></i>Tiempo real</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cambiar Contrase√±a -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">
                        <i class="fas fa-key me-2"></i>Cambiar Contrase√±a
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">
                                <i class="fas fa-lock me-2"></i>Contrase√±a Actual
                            </label>
                            <input type="password" class="form-control" id="currentPassword" required autocomplete="current-password"
                                   placeholder="Ingrese su contrase√±a actual">
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">
                                <i class="fas fa-key me-2"></i>Nueva Contrase√±a
                            </label>
                            <input type="password" class="form-control" id="newPassword" required autocomplete="new-password"
                                   placeholder="Ingrese su nueva contrase√±a" minlength="8">
                            <div class="form-text">La contrase√±a debe tener al menos 8 caracteres.</div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">
                                <i class="fas fa-check-circle me-2"></i>Confirmar Nueva Contrase√±a
                            </label>
                            <input type="password" class="form-control" id="confirmPassword" required autocomplete="new-password"
                                   placeholder="Confirme su nueva contrase√±a">
                        </div>
                        <div id="passwordStrengthIndicator" class="mb-3" style="display: none;">
                            <div class="progress" style="height: 5px;">
                                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted" id="strengthText">Fortaleza de la contrase√±a</small>
                        </div>
                    </form>
                    <div id="passwordChangeMessage" class="alert" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="updatePassword()">
                        <i class="fas fa-save me-2"></i>Actualizar Contrase√±a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Configurar Estad√≠sticas -->
    <div class="modal fade" id="statisticsConfigModal" tabindex="-1" aria-labelledby="statisticsConfigModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h5 class="modal-title text-white" id="statisticsConfigModalLabel">
                        <i class="fas fa-chart-line me-2"></i>Configurar Estad√≠sticas Institucionales
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="statisticsConfigForm">
                        <div class="row g-4">
                            <!-- Columna 1 -->
                            <div class="col-md-6">
                                <!-- Tarjeta Estudiantes -->
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-user-graduate me-2"></i>Total de Estudiantes
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <input type="number" class="form-control form-control-lg text-center"
                                               id="configTotalStudents" placeholder="Ej: 1247" min="0" max="9999">
                                        <small class="text-muted">N√∫mero total de estudiantes matriculados</small>
                                    </div>
                                </div>

                                <!-- Tarjeta Materias -->
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-warning text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-book me-2"></i>Total de Materias
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <input type="number" class="form-control form-control-lg text-center"
                                               id="configTotalSubjects" placeholder="Ej: 42" min="0" max="999">
                                        <small class="text-muted">Materias ofrecidas en el plantel</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Columna 2 -->
                            <div class="col-md-6">
                                <!-- Tarjeta Docentes -->
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-chalkboard-teacher me-2"></i>Total de Docentes
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <input type="number" class="form-control form-control-lg text-center"
                                               id="configTotalTeachers" placeholder="Ej: 68" min="0" max="999">
                                        <small class="text-muted">Personal docente activo</small>
                                    </div>
                                </div>

                                <!-- Tarjeta Promedio -->
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-chart-line me-2"></i>Promedio General
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <input type="number" class="form-control form-control-lg text-center"
                                               id="configGeneralAverage" placeholder="Ej: 8.4" min="0" max="10" step="0.1">
                                        <small class="text-muted">Promedio institucional actual</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-light border-primary mt-4">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-info-circle text-primary me-3 fa-2x"></i>
                                <div>
                                    <strong>Configuraci√≥n Avanzada</strong>
                                    <p class="mb-0">Estos datos se almacenan de forma persistente y se actualizan autom√°ticamente en todo el sistema. Los cambios son inmediatos y permanentes.</p>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div id="statisticsConfigMessage" class="alert" style="display: none;"></div>
                </div>
                <div class="modal-footer border-0 bg-light">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveStatisticsConfig()">
                        <i class="fas fa-save me-2"></i>Guardar Configuraci√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel Administrativo - Siempre Visible -->
    <div id="adminPanel">
        <!-- Header del Dashboard -->
        <section class="py-4 bg-primary text-white" style="margin-top: 20px;">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4 class="mb-0">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard Administrativo
                            <span class="badge bg-warning ms-2" id="adminRoleBadge">Director</span>
                        </h4>
                        <small>Bienvenido, <span id="adminName">Administrador</span></small>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-outline-light btn-sm me-2" onclick="showChangePasswordModal()">
                            <i class="fas fa-key me-1"></i>Cambiar Contrase√±a
                        </button>
                        <button class="btn btn-outline-light btn-sm me-2" onclick="refreshDashboard()">
                            <i class="fas fa-sync-alt me-1"></i>Actualizar
                        </button>
                        <button class="btn btn-outline-light btn-sm" onclick="logoutAdmin()">
                            <i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesi√≥n
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Estad√≠sticas Generales -->
        <section class="py-4">
            <div class="container">
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm stat-card">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="me-3">
                                        <i class="fas fa-user-graduate fa-3x text-primary"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-primary mb-0" id="totalStudents">1,247</h3>
                                        <p class="text-muted mb-0">Estudiantes</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm stat-card">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="me-3">
                                        <i class="fas fa-chalkboard-teacher fa-3x text-success"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-success mb-0" id="totalTeachers">68</h3>
                                        <p class="text-muted mb-0">Docentes</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm stat-card">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="me-3">
                                        <i class="fas fa-book fa-3x text-warning"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-warning mb-0" id="totalSubjects">42</h3>
                                        <p class="text-muted mb-0">Materias</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm stat-card">
                            <div class="card-body text-center">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="me-3">
                                        <i class="fas fa-chart-line fa-3x text-info"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-info mb-0" id="generalAverage">8.4</h3>
                                        <p class="text-muted mb-0">Promedio General</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Bot√≥n de configuraci√≥n de estad√≠sticas -->
                    <div class="col-12 text-center mt-4">
                        <button class="btn btn-outline-primary btn-sm" onclick="showStatisticsConfigModal()" title="Configurar estad√≠sticas">
                            <i class="fas fa-cog me-2"></i>Configurar Estad√≠sticas
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Navegaci√≥n por Pesta√±as -->
        <section class="py-4 bg-light">
            <div class="container">
                <ul class="nav nav-pills nav-fill mb-4" id="adminTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview" type="button" role="tab">
                            <i class="fas fa-chart-pie me-2"></i>Resumen
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="students-tab" data-bs-toggle="pill" data-bs-target="#students" type="button" role="tab">
                            <i class="fas fa-users me-2"></i>Estudiantes
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="teachers-tab" data-bs-toggle="pill" data-bs-target="#teachers" type="button" role="tab">
                            <i class="fas fa-chalkboard-teacher me-2"></i>Docentes
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="registrations-tab" data-bs-toggle="pill" data-bs-target="#registrations" type="button" role="tab">
                            <i class="fas fa-user-plus me-2"></i>Solicitudes
                            <span class="badge bg-warning ms-1" id="pending-count" style="display: none;">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="egresados-tab" data-bs-toggle="pill" data-bs-target="#egresados" type="button" role="tab">
                            <i class="fas fa-user-graduate me-2"></i>Egresados
                            <span class="badge bg-info ms-1" id="egresados-count">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="bolsa-trabajo-tab" data-bs-toggle="pill" data-bs-target="#bolsa-trabajo" type="button" role="tab">
                            <i class="fas fa-briefcase me-2"></i>Bolsa de Trabajo
                            <span class="badge bg-warning ms-1" id="bolsa-trabajo-count">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="suscriptores-tab" data-bs-toggle="pill" data-bs-target="#suscriptores" type="button" role="tab">
                            <i class="fas fa-envelope me-2"></i>Suscriptores
                            <span class="badge bg-primary ms-1" id="suscriptores-count">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="activeusers-tab" data-bs-toggle="pill" data-bs-target="#activeusers" type="button" role="tab">
                            <i class="fas fa-users-cog me-2"></i>Usuarios Activos
                            <span class="badge bg-success ms-1" id="active-users-count">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="finances-tab" data-bs-toggle="pill" data-bs-target="#finances" type="button" role="tab">
                            <i class="fas fa-dollar-sign me-2"></i>Finanzas
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="content-tab" data-bs-toggle="pill" data-bs-target="#content" type="button" role="tab">
                            <i class="fas fa-edit me-2"></i>Contenido
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reports-tab" data-bs-toggle="pill" data-bs-target="#reports" type="button" role="tab">
                            <i class="fas fa-file-alt me-2"></i>Reportes
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="manual-admin-tab" data-bs-toggle="pill" data-bs-target="#manual-admin" type="button" role="tab">
                            <i class="fas fa-cogs me-2"></i>Sistema Manual
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="adminTabsContent">
                    <!-- Tab Resumen -->
                    <div class="tab-pane fade show active" id="overview" role="tabpanel">
                        <div class="row g-4 dashboard-academic-section">
                            <div class="col-lg-8">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-chart-bar me-2"></i>Evoluci√≥n Acad√©mica
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="academicChart" style="max-height: 200px; max-width: 100%;"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-trophy me-2"></i>Rendimiento por Semestre
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>1¬∞ Semestre</span>
                                            <span class="badge bg-success">8.7</span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>3¬∞ Semestre</span>
                                            <span class="badge bg-primary">8.4</span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>5¬∞ Semestre</span>
                                            <span class="badge bg-info">8.2</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-warning text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-exclamation-triangle me-2"></i>Alertas
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="alert alert-warning mb-2">
                                            <small><i class="fas fa-user me-1"></i>15 estudiantes en riesgo acad√©mico</small>
                                        </div>
                                        <div class="alert alert-info mb-2">
                                            <small><i class="fas fa-dollar-sign me-1"></i>23 pagos pendientes</small>
                                        </div>
                                        <div class="alert alert-success mb-0">
                                            <small><i class="fas fa-check me-1"></i>Sistema funcionando correctamente</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Analytics Institucionales - Reubicado dentro de la pesta√±a Resumen -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-transparent border-0 pb-0">
                                        <h5 class="mb-0 text-primary">
                                            <i class="fas fa-chart-area me-2"></i>Analytics Institucionales
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-4">
                                            <div class="col-lg-8">
                                                <canvas id="institutional-trends-chart" style="max-height: 250px;"></canvas>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="h-100 d-flex flex-column justify-content-center">
                                                    <div class="text-center mb-4">
                                                        <h3 class="text-success mb-1">96.8%</h3>
                                                        <small class="text-muted">Satisfacci√≥n General</small>
                                                    </div>
                                                    <div class="text-center mb-4">
                                                        <h3 class="text-info mb-1">1,247</h3>
                                                        <small class="text-muted">Estudiantes Activos</small>
                                                    </div>
                                                    <div class="text-center">
                                                        <h3 class="text-warning mb-1">68</h3>
                                                        <small class="text-muted">Docentes</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Estudiantes -->
                    <div class="tab-pane fade" id="students" role="tabpanel">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-users me-2"></i>Gesti√≥n de Estudiantes
                                    <span class="badge bg-light text-primary ms-2" id="totalStudentsCount">0</span>
                                </h5>
                                <div>
                                    <span class="badge bg-light text-primary me-2">
                                        <i class="fas fa-check-circle me-1"></i>
                                        <span id="activeStudentsCount">0</span> Activos
                                    </span>
                                    <span class="badge bg-light text-warning me-2">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        <span id="riskStudentsCount">0</span> En Riesgo
                                    </span>
                                    <span class="badge bg-light text-primary me-2">
                                        <i class="fas fa-star me-1"></i>
                                        <span id="generalAverageDisplay">0.0</span> Promedio
                                    </span>
                                    <button class="btn btn-light btn-sm me-2" id="exportStudentsBtn">
                                        <i class="fas fa-download me-1"></i>Exportar
                                    </button>
                                    <button class="btn btn-warning btn-sm" id="newStudentBtn">
                                        <i class="fas fa-plus me-1"></i>Nuevo
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                                            <input type="text" class="form-control" id="studentSearchInput" placeholder="Buscar por nombre o matr√≠cula...">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="studentFilterSemester">
                                            <option value="">Todos los semestres</option>
                                            <option value="1¬∞">1¬∞ Semestre</option>
                                            <option value="2¬∞">2¬∞ Semestre</option>
                                            <option value="3¬∞">3¬∞ Semestre</option>
                                            <option value="4¬∞">4¬∞ Semestre</option>
                                            <option value="5¬∞">5¬∞ Semestre</option>
                                            <option value="6¬∞">6¬∞ Semestre</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="studentFilterStatus">
                                            <option value="">Todos los estados</option>
                                            <option value="Activo">Activos</option>
                                            <option value="En Riesgo">En Riesgo</option>
                                            <option value="Inactivo">Inactivos</option>
                                            <option value="Egresado">Egresados</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-outline-primary w-100" onclick="reloadStudents()">
                                            <i class="fas fa-sync me-1"></i>Actualizar
                                        </button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-primary">
                                            <tr>
                                                <th>Matr√≠cula</th>
                                                <th>Informaci√≥n</th>
                                                <th>Semestre</th>
                                                <th>Promedio</th>
                                                <th>Estado</th>
                                                <th width="200">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="studentsTable">
                                            <tr>
                                                <td colspan="6" class="text-center py-4">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div>
                                                    <p class="mt-2 text-muted">Cargando informaci√≥n de estudiantes...</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Docentes -->
                    <div class="tab-pane fade" id="teachers" role="tabpanel">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-chalkboard-teacher me-2"></i>Gesti√≥n de Docentes
                                    <span class="badge bg-light text-success ms-2" id="totalTeachersCount">0</span>
                                </h5>
                                <div>
                                    <span class="badge bg-light text-success me-2">
                                        <i class="fas fa-check-circle me-1"></i>
                                        <span id="activeTeachersCount">0</span> Activos
                                    </span>
                                    <span class="badge bg-light text-success me-2">
                                        <i class="fas fa-graduation-cap me-1"></i>
                                        <span id="specialtiesCount">0</span> Especialidades
                                    </span>
                                    <button class="btn btn-light btn-sm" id="newTeacherBtn">
                                        <i class="fas fa-plus me-1"></i>Nuevo Docente
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                                            <input type="text" class="form-control" id="teacherSearchInput" placeholder="Buscar por nombre o especialidad...">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="teacherFilterSpecialty">
                                            <option value="">Todas las especialidades</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="teacherFilterStatus">
                                            <option value="">Todos los estados</option>
                                            <option value="Activo">Activos</option>
                                            <option value="Inactivo">Inactivos</option>
                                            <option value="Licencia">En Licencia</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-outline-primary w-100" onclick="reloadTeachers()">
                                            <i class="fas fa-sync me-1"></i>Actualizar
                                        </button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-success">
                                            <tr>
                                                <th width="60">Foto</th>
                                                <th>Informaci√≥n</th>
                                                <th>Especialidad</th>
                                                <th>Materias</th>
                                                <th>Estado</th>
                                                <th width="200">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="teachersTable">
                                            <tr>
                                                <td colspan="6" class="text-center py-4">
                                                    <div class="spinner-border text-success" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div>
                                                    <p class="mt-2 text-muted">Cargando informaci√≥n de docentes...</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Solicitudes de Registro -->
                    <div class="tab-pane fade" id="registrations" role="tabpanel">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-user-plus me-2"></i>Solicitudes de Registro
                                </h5>
                                <div>
                                    <span class="badge bg-warning me-2" id="pending-counter">0 pendientes</span>
                                    <button class="btn btn-success btn-sm me-2" onclick="adminDashboard.generateTestRequests();" title="Generar solicitudes de prueba">
                                        <i class="fas fa-flask me-1"></i>Generar Pruebas
                                    </button>
                                    <button class="btn btn-light btn-sm" onclick="adminDashboard.loadPendingRegistrations(); adminDashboard.displayPendingRegistrations();">
                                        <i class="fas fa-sync me-1"></i>Actualizar
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Gesti√≥n de Solicitudes:</strong> Aqu√≠ aparecer√°n todas las solicitudes de registro de nuevos usuarios.
                                    Puedes aprobar o rechazar cada solicitud despu√©s de revisar la informaci√≥n.
                                </div>
                                
                                <!-- Contenedor de solicitudes -->
                                <div id="pending-registrations-container">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-3x text-muted mb-3"></i>
                                        <p class="text-muted">Cargando solicitudes...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Egresados -->
                    <div class="tab-pane fade" id="egresados" role="tabpanel">
                        <div class="row g-4">
                            <!-- Estad√≠sticas de Egresados -->
                            <div class="col-12">
                                <div class="row g-3">
                                    <!-- Total Egresados -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Total Egresados</h6>
                                                        <h3 class="mb-0" id="stats-total">0</h3>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-user-graduate fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Titulados -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-success text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Titulados</h6>
                                                        <h3 class="mb-0" id="stats-titulados">0</h3>
                                                        <small id="porcentaje-titulados">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-certificate fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- En Universidad -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-info text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Estudiando</h6>
                                                        <h3 class="mb-0" id="stats-estudiando">0</h3>
                                                        <small id="porcentaje-estudiando">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-university fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Historias de √âxito -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-warning text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Historias Publicables</h6>
                                                        <h3 class="mb-0" id="stats-historias">0</h3>
                                                        <small id="porcentaje-historias">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-star fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Filtros y B√∫squeda -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filtros de B√∫squeda</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label">Buscar por nombre</label>
                                                <input type="text" class="form-control" id="search-egresado" placeholder="Ingrese nombre..." onkeyup="filterEgresados()">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Generaci√≥n</label>
                                                <select class="form-select" id="filter-generacion" onchange="filterEgresados()">
                                                    <option value="">Todas las generaciones</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Estatus</label>
                                                <select class="form-select" id="filter-estatus" onchange="filterEgresados()">
                                                    <option value="">Todos los estatus</option>
                                                    <!-- Se llenar√° din√°micamente desde la base de datos -->
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label class="form-label">&nbsp;</label>
                                                <button class="btn btn-outline-secondary w-100" id="clear-filters-egresados">
                                                    <i class="fas fa-times me-2"></i>Limpiar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla de Egresados -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-table me-2"></i>Registro de Egresados</h5>
                                        <div>
                                            <button class="btn btn-light btn-sm me-2" onclick="exportEgresados()">
                                                <i class="fas fa-download me-2"></i>Exportar
                                            </button>
                                            <button class="btn btn-light btn-sm" onclick="loadEgresados()">
                                                <i class="fas fa-sync-alt me-2"></i>Actualizar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <!-- Loading State -->
                                        <div id="egresados-loading" class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-3 text-muted">Cargando datos de egresados...</p>
                                        </div>

                                        <!-- Error State -->
                                        <div id="egresados-error" class="alert alert-danger m-3" style="display: none;">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            <span id="egresados-error-message">Error al cargar datos</span>
                                        </div>

                                        <!-- Empty State -->
                                        <div id="egresados-empty" class="text-center py-5" style="display: none;">
                                            <i class="fas fa-user-graduate fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">No hay egresados registrados</p>
                                        </div>

                                        <!-- Tabla Responsive -->
                                        <div id="egresados-table-container" class="table-responsive" style="display: none;">
                                            <table class="table table-hover align-middle mb-0" id="egresadosTable">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th>Nombre</th>
                                                        <th>Email</th>
                                                        <th>Generaci√≥n</th>
                                                        <th>Universidad</th>
                                                        <th>Estatus</th>
                                                        <th class="text-center">Verificado</th>
                                                        <th class="text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="egresados-table-body">
                                                    <!-- Se llenar√° din√°micamente por EgresadosManager -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="card-footer bg-light">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                Mostrando <span id="showing-count">0</span> de <span id="total-count">0</span> egresados
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================ -->
                    <!-- Tab Bolsa de Trabajo -->
                    <!-- ============================================ -->
                    <div class="tab-pane fade" id="bolsa-trabajo" role="tabpanel">
                        <div class="row g-4">
                            <!-- Estad√≠sticas de Bolsa de Trabajo -->
                            <div class="col-12">
                                <div class="row g-3">
                                    <!-- Total Candidatos -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-warning text-dark">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Total Candidatos</h6>
                                                        <h3 class="mb-0" id="stats-total-bolsa">0</h3>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-briefcase fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Nuevos (√∫ltimos 7 d√≠as) -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-success text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Nuevos (7 d√≠as)</h6>
                                                        <h3 class="mb-0" id="stats-nuevos-bolsa">0</h3>
                                                        <small id="porcentaje-nuevos-bolsa">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-user-plus fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Revisados -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-info text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Revisados</h6>
                                                        <h3 class="mb-0" id="stats-revisados-bolsa">0</h3>
                                                        <small id="porcentaje-revisados-bolsa">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-eye fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Contratados -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Contratados</h6>
                                                        <h3 class="mb-0" id="stats-contratados-bolsa">0</h3>
                                                        <small id="porcentaje-contratados-bolsa">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-check-circle fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Filtros y B√∫squeda -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filtros de B√∫squeda</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label">Buscar por nombre</label>
                                                <input type="text" class="form-control" id="search-bolsa" placeholder="Ingrese nombre..." onkeyup="filterBolsaTrabajo()">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Estado</label>
                                                <select class="form-select" id="filter-estado-bolsa" onchange="filterBolsaTrabajo()">
                                                    <option value="">Todos los estados</option>
                                                    <option value="nuevo">Nuevo</option>
                                                    <option value="revisado">Revisado</option>
                                                    <option value="contactado">Contactado</option>
                                                    <option value="entrevistado">Entrevistado</option>
                                                    <option value="contratado">Contratado</option>
                                                    <option value="descartado">Descartado</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Generaci√≥n</label>
                                                <select class="form-select" id="filter-generacion-bolsa" onchange="filterBolsaTrabajo()">
                                                    <option value="">Todas las generaciones</option>
                                                    <!-- Se llenar√° din√°micamente -->
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label class="form-label">&nbsp;</label>
                                                <button class="btn btn-outline-secondary w-100" onclick="clearFiltersBolsaTrabajo()">
                                                    <i class="fas fa-times me-2"></i>Limpiar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla de Bolsa de Trabajo -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-table me-2"></i>Candidatos Registrados</h5>
                                        <div>
                                            <button class="btn btn-dark btn-sm me-2" onclick="exportBolsaTrabajoCSV()">
                                                <i class="fas fa-download me-2"></i>Exportar CSV
                                            </button>
                                            <button class="btn btn-dark btn-sm" onclick="loadBolsaTrabajo()">
                                                <i class="fas fa-sync-alt me-2"></i>Actualizar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <!-- Loading State -->
                                        <div id="bolsa-loading" class="text-center py-5">
                                            <div class="spinner-border text-warning" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-3 text-muted">Cargando candidatos de bolsa de trabajo...</p>
                                        </div>

                                        <!-- Error State -->
                                        <div id="bolsa-error" class="alert alert-danger m-3" style="display: none;">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            <span id="bolsa-error-message">Error al cargar datos</span>
                                        </div>

                                        <!-- Empty State -->
                                        <div id="bolsa-empty" class="text-center py-5" style="display: none;">
                                            <i class="fas fa-briefcase fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">No hay candidatos registrados en la bolsa de trabajo</p>
                                        </div>

                                        <!-- Tabla Responsive -->
                                        <div id="bolsa-table-container" class="table-responsive" style="display: none;">
                                            <table class="table table-hover align-middle mb-0" id="bolsaTable">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th>Nombre</th>
                                                        <th>Email</th>
                                                        <th>Generaci√≥n</th>
                                                        <th>√Årea de Inter√©s</th>
                                                        <th>Estado</th>
                                                        <th>Fecha Registro</th>
                                                        <th class="text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="bolsa-table-body">
                                                    <!-- Se llenar√° din√°micamente por BolsaTrabajoManager -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="card-footer bg-light">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                Mostrando <span id="showing-count-bolsa">0</span> de <span id="total-count-bolsa">0</span> candidatos
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================ -->
                    <!-- Tab Suscriptores -->
                    <!-- ============================================ -->
                    <div class="tab-pane fade" id="suscriptores" role="tabpanel">
                        <div class="row g-4">
                            <!-- Estad√≠sticas de Suscriptores -->
                            <div class="col-12">
                                <div class="row g-3">
                                    <!-- Total Suscriptores -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Total Suscriptores</h6>
                                                        <h3 class="mb-0" id="stats-total-suscriptores">0</h3>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-envelope fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Activos -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-success text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Activos</h6>
                                                        <h3 class="mb-0" id="stats-activos-suscriptores">0</h3>
                                                        <small id="porcentaje-activos-suscriptores">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-check-circle fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Verificados -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-info text-white">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Verificados</h6>
                                                        <h3 class="mb-0" id="stats-verificados-suscriptores">0</h3>
                                                        <small id="porcentaje-verificados-suscriptores">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-user-check fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Nuevos (√∫ltimos 30 d√≠as) -->
                                    <div class="col-md-3">
                                        <div class="card border-0 shadow-sm h-100 bg-warning text-dark">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <h6 class="mb-1">Nuevos (30 d√≠as)</h6>
                                                        <h3 class="mb-0" id="stats-nuevos-suscriptores">0</h3>
                                                        <small id="porcentaje-nuevos-suscriptores">0%</small>
                                                    </div>
                                                    <div class="flex-shrink-0">
                                                        <i class="fas fa-user-plus fa-2x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Filtros y B√∫squeda -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filtros de B√∫squeda</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label">Buscar por email o nombre</label>
                                                <input type="text" class="form-control" id="search-suscriptor" placeholder="Ingrese email o nombre..." onkeyup="filterSuscriptores()">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Estado</label>
                                                <select class="form-select" id="filter-estado-suscriptor" onchange="filterSuscriptores()">
                                                    <option value="">Todos los estados</option>
                                                    <option value="activo">Activo</option>
                                                    <option value="inactivo">Inactivo</option>
                                                    <option value="cancelado">Cancelado</option>
                                                    <option value="pendiente">Pendiente Verificaci√≥n</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Verificaci√≥n</label>
                                                <select class="form-select" id="filter-verificacion-suscriptor" onchange="filterSuscriptores()">
                                                    <option value="">Todos</option>
                                                    <option value="verificado">Verificado</option>
                                                    <option value="no_verificado">No Verificado</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label class="form-label">&nbsp;</label>
                                                <button class="btn btn-outline-secondary w-100" onclick="clearFiltersSuscriptores()">
                                                    <i class="fas fa-times me-2"></i>Limpiar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla de Suscriptores -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-table me-2"></i>Lista de Suscriptores</h5>
                                        <div>
                                            <button class="btn btn-light btn-sm me-2" onclick="exportSuscriptoresCSV()">
                                                <i class="fas fa-download me-2"></i>Exportar CSV
                                            </button>
                                            <button class="btn btn-light btn-sm" onclick="loadSuscriptores()">
                                                <i class="fas fa-sync-alt me-2"></i>Actualizar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <!-- Loading State -->
                                        <div id="suscriptores-loading" class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-3 text-muted">Cargando lista de suscriptores...</p>
                                        </div>

                                        <!-- Error State -->
                                        <div id="suscriptores-error" class="alert alert-danger m-3" style="display: none;">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            <span id="suscriptores-error-message">Error al cargar datos</span>
                                        </div>

                                        <!-- Empty State -->
                                        <div id="suscriptores-empty" class="text-center py-5" style="display: none;">
                                            <i class="fas fa-envelope fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">No hay suscriptores registrados</p>
                                        </div>

                                        <!-- Tabla Responsive -->
                                        <div id="suscriptores-table-container" class="table-responsive" style="display: none;">
                                            <table class="table table-hover align-middle mb-0" id="suscriptoresTable">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th>Email</th>
                                                        <th>Nombre</th>
                                                        <th>Preferencias</th>
                                                        <th>Estado</th>
                                                        <th class="text-center">Verificado</th>
                                                        <th>Fecha Registro</th>
                                                        <th class="text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="suscriptores-table-body">
                                                    <!-- Se llenar√° din√°micamente por SuscriptoresManager -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="card-footer bg-light">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                Mostrando <span id="showing-count-suscriptores">0</span> de <span id="total-count-suscriptores">0</span> suscriptores
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Usuarios Activos -->
                    <div class="tab-pane fade" id="activeusers" role="tabpanel">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-users-cog me-2"></i>Gesti√≥n de Usuarios Activos
                                </h5>
                                <div>
                                    <span class="badge bg-light text-success me-2" id="active-users-counter">0 usuarios</span>
                                    <button class="btn btn-light btn-sm" onclick="adminDashboard.loadActiveUsers();" title="Actualizar lista de usuarios">
                                        <i class="fas fa-refresh me-1"></i>Actualizar
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Gesti√≥n de Usuarios Activos:</strong>
                                    Aqu√≠ puedes ver todos los usuarios que tienen acceso al sistema, revocar acceso a usuarios problem√°ticos y restaurar acceso cuando sea necesario.
                                </div>

                                <!-- Controles de b√∫squeda -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="fas fa-search"></i>
                                            </span>
                                            <input type="text" class="form-control" placeholder="Buscar por email..." id="searchActiveUsers">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <select class="form-select" id="filterUserStatus">
                                            <option value="">Todos los usuarios</option>
                                            <option value="active">Solo usuarios activos</option>
                                            <option value="revoked">Solo usuarios revocados</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Contenedor de usuarios activos -->
                                <div id="activeUsersContainer">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin fa-3x text-muted mb-3"></i>
                                        <p class="text-muted">Cargando usuarios...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Finanzas -->
                    <div class="tab-pane fade" id="finances" role="tabpanel">
                        <!-- Header con bot√≥n de configuraci√≥n -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4><i class="fas fa-dollar-sign me-2"></i>Gesti√≥n Financiera</h4>
                            <button class="btn btn-primary" id="financeConfigBtn">
                                <i class="fas fa-cog me-2"></i>Configurar Estad√≠sticas
                            </button>
                        </div>

                        <!-- Tarjetas de resumen financiero -->
                        <div class="row g-4 mb-4">
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body text-center">
                                        <i class="fas fa-dollar-sign fa-3x text-success mb-3"></i>
                                        <h4 class="text-success" id="ingresosMesCard">$0</h4>
                                        <p class="text-muted">Ingresos del Mes</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body text-center">
                                        <i class="fas fa-clock fa-3x text-warning mb-3"></i>
                                        <h4 class="text-warning" id="pagosPendientesCard">$0</h4>
                                        <p class="text-muted">Pagos Pendientes</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-pie fa-3x text-info mb-3"></i>
                                        <h4 class="text-info" id="tasaCobroCard">0%</h4>
                                        <p class="text-muted">Tasa de Cobro</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                                        <h4 class="text-primary" id="utilidadCard">$0</h4>
                                        <p class="text-muted">Utilidad del Mes</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs de gesti√≥n financiera -->
                        <ul class="nav nav-pills nav-fill mb-4" id="financeTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="overview-tab-2" data-bs-toggle="pill" data-bs-target="#overview-2" type="button" role="tab">
                                    <i class="fas fa-chart-pie me-2"></i>Resumen
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="incomes-tab" data-bs-toggle="pill" data-bs-target="#incomes" type="button" role="tab">
                                    <i class="fas fa-arrow-up me-2"></i>Ingresos
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="expenses-tab" data-bs-toggle="pill" data-bs-target="#expenses" type="button" role="tab">
                                    <i class="fas fa-arrow-down me-2"></i>Gastos
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="pending-tab" data-bs-toggle="pill" data-bs-target="#pending" type="button" role="tab">
                                    <i class="fas fa-clock me-2"></i>Pendientes
                                </button>
                            </li>
                        </ul>

                        <!-- Contenido de tabs -->
                        <div class="tab-content" id="financeTabContent">
                            <!-- Tab Resumen -->
                            <div class="tab-pane fade show active" id="overview-2" role="tabpanel">
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Indicadores Clave</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-6">
                                                        <div class="border-end">
                                                            <h5 id="margenUtilidadIndicator">0%</h5>
                                                            <small class="text-muted">Margen de Utilidad</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 id="promedioDiarioIndicator">$0</h5>
                                                        <small class="text-muted">Promedio Diario</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Alertas</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="financeAlerts">
                                                    <!-- Se llena din√°micamente -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Ingresos -->
                            <div class="tab-pane fade" id="incomes" role="tabpanel">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="fas fa-arrow-up me-2"></i>Registro de Ingresos</h6>
                                        <button class="btn btn-success btn-sm">
                                            <i class="fas fa-plus me-1"></i>Nuevo Ingreso
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <!-- Controles de b√∫squeda y filtros -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <i class="fas fa-search"></i>
                                                    </span>
                                                    <input type="text" class="form-control" id="searchIncomes"
                                                           placeholder="Buscar por concepto, categor√≠a o descripci√≥n...">
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-select" id="filterIncomeCategory">
                                                    <option value="all">Todas las categor√≠as</option>
                                                    <option value="Colegiaturas">Colegiaturas</option>
                                                    <option value="Inscripciones">Inscripciones</option>
                                                    <option value="Servicios">Servicios</option>
                                                    <option value="Tr√°mites">Tr√°mites</option>
                                                    <option value="Eventos">Eventos</option>
                                                    <option value="Otros">Otros</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-outline-secondary" onclick="document.getElementById('searchIncomes').value=''; document.getElementById('filterIncomeCategory').value='all'; dynamicFinanceLoader.updateIncomeTable();">
                                                    <i class="fas fa-times me-1"></i>Limpiar
                                                </button>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="incomesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Concepto</th>
                                                        <th>Categor√≠a</th>
                                                        <th>Monto</th>
                                                        <th>Fecha</th>
                                                        <th>Estado</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Se llena din√°micamente -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Gastos -->
                            <div class="tab-pane fade" id="expenses" role="tabpanel">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="fas fa-arrow-down me-2"></i>Registro de Gastos</h6>
                                        <button class="btn btn-danger btn-sm">
                                            <i class="fas fa-plus me-1"></i>Nuevo Gasto
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <!-- Controles de b√∫squeda y filtros -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <i class="fas fa-search"></i>
                                                    </span>
                                                    <input type="text" class="form-control" id="searchExpenses"
                                                           placeholder="Buscar por concepto, categor√≠a o descripci√≥n...">
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-select" id="filterExpenseCategory">
                                                    <option value="all">Todas las categor√≠as</option>
                                                    <option value="Personal">Personal</option>
                                                    <option value="Servicios">Servicios</option>
                                                    <option value="Materiales">Materiales</option>
                                                    <option value="Mantenimiento">Mantenimiento</option>
                                                    <option value="Administrativos">Administrativos</option>
                                                    <option value="Otros">Otros</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-outline-secondary" onclick="document.getElementById('searchExpenses').value=''; document.getElementById('filterExpenseCategory').value='all'; dynamicFinanceLoader.updateExpenseTable();">
                                                    <i class="fas fa-times me-1"></i>Limpiar
                                                </button>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="expensesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Concepto</th>
                                                        <th>Categor√≠a</th>
                                                        <th>Monto</th>
                                                        <th>Fecha</th>
                                                        <th>Estado</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Se llena din√°micamente -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Pendientes -->
                            <div class="tab-pane fade" id="pending" role="tabpanel">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Pagos Pendientes</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Controles de b√∫squeda y filtros -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <i class="fas fa-search"></i>
                                                    </span>
                                                    <input type="text" class="form-control" id="searchPendingPayments"
                                                           placeholder="Buscar por estudiante, matr√≠cula o concepto...">
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-select" id="filterPaymentStatus">
                                                    <option value="all">Todos los estados</option>
                                                    <option value="Vencido">Vencido</option>
                                                    <option value="Pr√≥ximo">Pr√≥ximo</option>
                                                    <option value="Vigente">Vigente</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-outline-secondary" onclick="document.getElementById('searchPendingPayments').value=''; document.getElementById('filterPaymentStatus').value='all'; dynamicFinanceLoader.updatePendingPaymentsTable();">
                                                    <i class="fas fa-times me-1"></i>Limpiar
                                                </button>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="pendingPaymentsTable">
                                                <thead>
                                                    <tr>
                                                        <th>Estudiante</th>
                                                        <th>Concepto</th>
                                                        <th>Monto</th>
                                                        <th>Vencimiento</th>
                                                        <th>Estado</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Se llena din√°micamente -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Gesti√≥n de Contenido -->
                    <div class="tab-pane fade" id="content" role="tabpanel">
                        <div class="row g-4">
                            <!-- Panel de Estad√≠sticas del CMS -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                        <h5 class="text-white mb-0">
                                            <i class="fas fa-chart-pie me-2"></i>Sistema de Gesti√≥n de Contenido (CMS)
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3" id="cmsStats">
                                            <div class="col-md-3">
                                                <div class="card bg-primary text-white">
                                                    <div class="card-body text-center">
                                                        <i class="fas fa-newspaper fa-2x mb-2"></i>
                                                        <h4 id="totalNoticias">0</h4>
                                                        <small>Noticias</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card bg-success text-white">
                                                    <div class="card-body text-center">
                                                        <i class="fas fa-calendar-alt fa-2x mb-2"></i>
                                                        <h4 id="totalEventos">0</h4>
                                                        <small>Eventos</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card bg-warning text-white">
                                                    <div class="card-body text-center">
                                                        <i class="fas fa-bullhorn fa-2x mb-2"></i>
                                                        <h4 id="totalAvisos">0</h4>
                                                        <small>Avisos</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="card bg-info text-white">
                                                    <div class="card-body text-center">
                                                        <i class="fas fa-file-alt fa-2x mb-2"></i>
                                                        <h4 id="totalComunicados">0</h4>
                                                        <small>Comunicados</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Acciones R√°pidas -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">
                                            <i class="fas fa-plus-circle me-2 text-primary"></i>Crear Nuevo Contenido
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <button class="btn btn-primary w-100" onclick="showCreateNoticiaModal()">
                                                    <i class="fas fa-newspaper me-2"></i>Nueva Noticia
                                                </button>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-success w-100" onclick="showCreateEventoModal()">
                                                    <i class="fas fa-calendar-plus me-2"></i>Nuevo Evento
                                                </button>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-warning w-100" onclick="showCreateAvisoModal()">
                                                    <i class="fas fa-bullhorn me-2"></i>Nuevo Aviso
                                                </button>
                                            </div>
                                            <div class="col-md-3">
                                                <button class="btn btn-info w-100" onclick="showCreateComunicadoModal()">
                                                    <i class="fas fa-file-alt me-2"></i>Nuevo Comunicado
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gesti√≥n de Contenido Existente -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <i class="fas fa-list me-2 text-secondary"></i>Contenido Existente
                                        </h6>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary active" id="btnViewNoticias" onclick="viewContentType('noticias')">
                                                Noticias
                                            </button>
                                            <button class="btn btn-outline-success" id="btnViewEventos" onclick="viewContentType('eventos')">
                                                Eventos
                                            </button>
                                            <button class="btn btn-outline-warning" id="btnViewAvisos" onclick="viewContentType('avisos')">
                                                Avisos
                                            </button>
                                            <button class="btn btn-outline-info" id="btnViewComunicados" onclick="viewContentType('comunicados')">
                                                Comunicados
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="contentList" class="table-responsive">
                                            <!-- Aqu√≠ se cargar√° din√°micamente el contenido -->
                                            <div class="text-center text-muted py-4">
                                                <i class="fas fa-inbox fa-3x mb-3"></i>
                                                <p>Seleccione un tipo de contenido para ver los elementos existentes.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Herramientas Adicionales -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">
                                            <i class="fas fa-tools me-2 text-dark"></i>Herramientas de Gesti√≥n
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <button class="btn btn-outline-secondary w-100" onclick="exportAllContent()">
                                                    <i class="fas fa-download me-2"></i>Exportar Todo
                                                </button>
                                            </div>
                                            <div class="col-md-4">
                                                <button class="btn btn-outline-primary w-100" onclick="refreshContentStats()">
                                                    <i class="fas fa-sync me-2"></i>Actualizar Estad√≠sticas
                                                </button>
                                            </div>
                                            <div class="col-md-4">
                                                <button class="btn btn-outline-info w-100" onclick="showContentPreview()">
                                                    <i class="fas fa-eye me-2"></i>Vista Previa Web
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Reportes -->
                    <div class="tab-pane fade" id="reports" role="tabpanel">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-file-alt me-2"></i>Reportes Acad√©micos
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-outline-primary" onclick="generateReport('academic')">
                                                <i class="fas fa-graduation-cap me-2"></i>Reporte de Calificaciones
                                            </button>
                                            <button class="btn btn-outline-success" onclick="generateReport('attendance')">
                                                <i class="fas fa-calendar-check me-2"></i>Reporte de Asistencia
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="generateReport('performance')">
                                                <i class="fas fa-chart-bar me-2"></i>An√°lisis de Rendimiento
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-dollar-sign me-2"></i>Reportes Financieros
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-outline-info" onclick="generateReport('payments')">
                                                <i class="fas fa-credit-card me-2"></i>Estado de Pagos
                                            </button>
                                            <button class="btn btn-outline-secondary" onclick="generateReport('income')">
                                                <i class="fas fa-chart-line me-2"></i>Ingresos Mensuales
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="generateReport('pending')">
                                                <i class="fas fa-exclamation-triangle me-2"></i>Pagos Vencidos
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Sistema Manual -->
                    <div class="tab-pane fade" id="manual-admin" role="tabpanel">
                        <div class="row g-4">
                            <!-- Sistema de Administraci√≥n Manual -->
                            <div class="col-12">
                                <div class="alert alert-warning">
                                    <h5><i class="fas fa-info-circle me-2"></i>Sistema de Administraci√≥n Manual</h5>
                                    <p class="mb-0"><strong>‚úÖ Configuraci√≥n Completada</strong> - El sistema ha sido configurado para usar edici√≥n manual via GitHub. Los m√©todos autom√°ticos (OAuth/CMS) han sido deshabilitados por problemas de compatibilidad.</p>
                                </div>
                            </div>

                            <!-- GitHub Direct -->
                            <div class="col-lg-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">
                                            <i class="fab fa-github me-2"></i>Edici√≥n Directa en GitHub
                                            <span class="badge bg-light text-success ms-2">Recomendado</span>
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">La forma m√°s simple y directa de editar el contenido:</p>
                                        <ol class="small">
                                            <li>Ve a tu repositorio: <code>SACRINT/heroes_de_la_patria_oficial</code></li>
                                            <li>Navega a la carpeta <code>data/</code></li>
                                            <li>Haz clic en el archivo que quieres editar</li>
                                            <li>Haz clic en el √≠cono del l√°piz <i class="fas fa-edit"></i> para editar</li>
                                            <li>Modifica el contenido en formato JSON</li>
                                            <li>Haz clic en "Commit changes"</li>
                                        </ol>
                                        <div class="d-grid">
                                            <a href="https://github.com/SACRINT/heroes_de_la_patria_oficial/tree/main/data" target="_blank" class="btn btn-success">
                                                <i class="fab fa-github me-2"></i>Ir a GitHub
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Archivos de Contenido -->
                            <div class="col-lg-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-file-code me-2"></i>Archivos de Contenido
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="list-group list-group-flush">
                                                    <div class="list-group-item px-0">
                                                        <strong>config.json</strong><br>
                                                        <small class="text-muted">Informaci√≥n general de la instituci√≥n</small>
                                                    </div>
                                                    <div class="list-group-item px-0">
                                                        <strong>noticias.json</strong><br>
                                                        <small class="text-muted">Comunicados y avisos</small>
                                                    </div>
                                                    <div class="list-group-item px-0">
                                                        <strong>docentes.json</strong><br>
                                                        <small class="text-muted">Informaci√≥n del personal</small>
                                                    </div>
                                                    <div class="list-group-item px-0">
                                                        <strong>eventos_calendario_pwa.json</strong><br>
                                                        <small class="text-muted">Eventos y fechas importantes</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Herramientas Adicionales -->
                            <div class="col-lg-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-tools me-2"></i>Herramientas Adicionales
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <a href="https://desktop.github.com/" target="_blank" class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-download me-2"></i>GitHub Desktop
                                            </a>
                                            <a href="https://jsoneditoronline.org/" target="_blank" class="btn btn-outline-secondary btn-sm">
                                                <i class="fas fa-code me-2"></i>Editor JSON Online
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Estado del Sitio -->
                            <div class="col-lg-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-header bg-warning text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-chart-line me-2"></i>Estado del Sitio
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <a href="https://SACRINT.github.io/heroes_de_la_patria_oficial/" target="_blank" class="btn btn-outline-primary btn-sm">
                                                <i class="fas fa-globe me-2"></i>Ver Sitio Web
                                            </a>
                                            <a href="https://github.com/SACRINT/heroes_de_la_patria_oficial" target="_blank" class="btn btn-outline-secondary btn-sm">
                                                <i class="fab fa-github me-2"></i>Ver Repositorio
                                            </a>
                                            <a href="https://github.com/SACRINT/heroes_de_la_patria_oficial/commits/main" target="_blank" class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-history me-2"></i>Ver Cambios
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Seguridad del Sistema -->
                            <div class="col-12">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-secondary text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-shield-alt me-2"></i>Seguridad del Sistema
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>üîí Sistema Seguro:</strong> Solo el propietario del repositorio GitHub puede realizar cambios. No se requieren contrase√±as adicionales ya que GitHub maneja toda la autenticaci√≥n.</p>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <ul class="list-unstyled small">
                                                    <li>‚úÖ Solo t√∫ puedes editar los archivos (autenticaci√≥n GitHub)</li>
                                                    <li>‚úÖ Historial completo de cambios en GitHub</li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <ul class="list-unstyled small">
                                                    <li>‚úÖ Posibilidad de revertir cambios si es necesario</li>
                                                    <li>‚úÖ Sin riesgos de seguridad adicionales</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <div id="main-footer"></div>

    <!-- Dark Mode Toggle -->
    <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Alternar modo oscuro">
        <i class="fas fa-moon"></i>
    </button>
    
    <!-- Chat Bot Toggle Button -->
    <button class="chatbot-toggle" id="chatbotToggle" aria-label="Abrir chat de ayuda">
        <i class="fas fa-comments"></i>
    </button>
    
    <!-- Chat Bot Container -->
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div>
                <strong>Asistente Virtual</strong>
                <div style="font-size: 12px; opacity: 0.8;">H√©roes de la Patria</div>
            </div>
            <button onclick="toggleChatbot()" style="background: none; border: none; color: white; font-size: 18px; position: absolute; top: 10px; right: 15px;" aria-label="Cerrar chat">√ó</button>
        </div>
        
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chatbot-message bot">
                <div class="response-professional">
                    <div class="response-title">üéì Asistente Virtual BGE</div>
                    <div class="response-content">
                        <div class="response-section">
                            <div class="response-subtitle">¬°Hola! Soy tu asistente inteligente</div>
                            <div class="response-text">Puedo ayudarte con informaci√≥n sobre admisiones, carreras, becas, horarios, y todo lo relacionado con nuestro bachillerato.</div>
                        </div>
                    </div>
                    <div class="response-footer">¬øEn qu√© puedo ayudarte hoy?</div>
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="message bot typing">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Escribe tu pregunta..." onkeypress="handleKeyPress(event)" aria-label="Escribe tu pregunta">
            <button onclick="sendMessage()" aria-label="Enviar mensaje">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- üöÄ BGE FRAMEWORK MODULAR - ADMIN DASHBOARD -->

    <!-- üîÑ LIMPIEZA DE CACHE Y SERVICE WORKER PARA FORZAR RECARGA -->
    <script>
        (async function() {
            console.log('üßπ [CACHE CLEANUP] Iniciando limpieza de cache...');

            // 1. Limpiar Service Workers
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (let registration of registrations) {
                    await registration.unregister();
                    console.log('‚úÖ Service Worker desregistrado:', registration.scope);
                }
            }

            // 2. Limpiar Cache Storage
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                for (let cacheName of cacheNames) {
                    await caches.delete(cacheName);
                    console.log('‚úÖ Cache eliminado:', cacheName);
                }
            }

            // 3. Limpiar localStorage de scripts antiguos
            const keysToRemove = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.includes('script_') || key.includes('cache_'))) {
                    keysToRemove.push(key);
                }
            }
            keysToRemove.forEach(key => localStorage.removeItem(key));

            console.log('‚úÖ [CACHE CLEANUP] Limpieza completada - Scripts frescos se cargar√°n');
        })();
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- üìä Chart.js para gr√°ficos del dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script>
        if (typeof Chart === 'undefined') {
            console.warn('Chart.js failed to load from CDN, loading from alternative source...');
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"><\/script>');
        }
    </script>

    <!-- üîß SISTEMA CORE (OBLIGATORIO) - VERSIONADO PARA FORZAR RECARGA -->
    <script src="js/context-manager.js?v=20251001-1430"></script>        <!-- üîí Base del sistema -->
    <script src="js/config.js?v=20251001-1430"></script>    <!-- üîß Configuraci√≥n global -->
    <script src="js/content-manager.js?v=20251001-1430"></script>        <!-- üìù Gesti√≥n de contenido -->
    <script src="js/script.js?v=20251001-1430"></script>                 <!-- üîí Script principal -->

    <!-- üìù LOGGER CENTRALIZADO (debe cargar primero) -->
    <script src="js/core/logger.js?v=20251001-1430"></script>

    <!-- üéØ BGE FRAMEWORK CORE -->
    <!-- ‚ö†Ô∏è IMPORTANTE: bge-framework-core.js AUTOM√ÅTICAMENTE carga performance y security -->
    <!-- ‚ö†Ô∏è NO CARGAR M√ìDULOS MANUALMENTE PARA EVITAR DUPLICACI√ìN -->
    <script src="js/bge-framework-core.js?v=FINAL2025"></script>

    <!-- üìä M√ìDULOS BGE ADICIONALES (Solo los que NO carga autom√°ticamente el core) -->
    <script src="js/bge-analytics-module.js?v=FINAL2025"></script>    <!-- üìä Analytics avanzado -->
    <script src="js/bge-pwa-module.js?v=FINAL2025"></script>         <!-- üì± PWA features -->

    <!-- üîß FUNCIONALIDADES DESARROLLO -->
    <!-- <script src="js/dev-override.js?v=20251001"></script> -->    <!-- ‚ö†Ô∏è DESHABILITADO PARA PRODUCCI√ìN -->

    <!-- üîß FUNCIONALIDADES ESPEC√çFICAS DEL DASHBOARD -->
    <script src="js/chatbot.js?v=20251001-1430"></script>                <!-- ü§ñ Chatbot admin -->
    <script src="js/search-simple.js?v=20251001-1430"></script>          <!-- üîç B√∫squeda -->
    <script src="js/api-client.js?v=20251001-1430"></script>             <!-- üîó Cliente API -->
    <script src="js/dashboard-manager-2025.js?v=FINAL2025"></script> <!-- üìä Gestor principal dashboard CORREGIDO -->
    <script src="js/dynamic-dashboard-data.js?v=20251001-1430"></script> <!-- üìà Datos din√°micos -->
    <script src="js/dynamic-stats-loader.js?v=20251001-1430"></script>   <!-- üìä Estad√≠sticas -->
    <script src="js/dynamic-teacher-loader.js?v=20251001-1430"></script> <!-- üë®‚Äçüè´ Datos docentes -->
    <script src="js/dynamic-student-loader.js?v=20251001-1430"></script> <!-- üë®‚Äçüéì Datos estudiantes -->
    <script src="js/dynamic-finance-loader.js?v=20251001-1430"></script> <!-- üí∞ Datos financieros -->
    <script src="js/academic-reports-manager.js?v=20251001-1430"></script> <!-- üìã Reportes acad√©micos -->
    <script src="js/bolsa-trabajo-manager.js?v=20251009"></script>       <!-- üíº Gestor Bolsa de Trabajo -->
    <script src="js/suscriptores-manager.js?v=20251009"></script>         <!-- üìß Gestor de Suscriptores -->

    <!-- üéì Panel de Egresados - NUEVO -->
    <script>
    /**
     * M√ìDULO DE GESTI√ìN DE EGRESADOS
     * Sistema simplificado integrado con el dashboard
     * Versi√≥n: 1.0.0 - 03-OCT-2025
     */
    class EgresadosManager {
        constructor() {
            this.egresados = [];
            this.filteredEgresados = [];
            this.apiBaseUrl = 'http://localhost:3000/api';
            console.log('‚úÖ [EgresadosManager] M√≥dulo inicializado');
        }

        async init() {
            console.log('üöÄ [EgresadosManager] Iniciando m√≥dulo de egresados...');
            await this.loadEgresados();
            this.setupEventListeners();
        }

        async loadEgresados() {
            const loadingEl = document.getElementById('egresados-loading');
            const errorEl = document.getElementById('egresados-error');
            const emptyEl = document.getElementById('egresados-empty');
            const tableContainer = document.getElementById('egresados-table-container');

            if (loadingEl) loadingEl.style.display = 'block';
            if (errorEl) errorEl.style.display = 'none';
            if (emptyEl) emptyEl.style.display = 'none';
            if (tableContainer) tableContainer.style.display = 'none';

            try {
                const response = await fetch(`${this.apiBaseUrl}/egresados`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const result = await response.json();
                console.log('üì¶ [EgresadosManager] Respuesta del servidor:', result);
                if (result.success) {
                    this.egresados = result.egresados || result.data || [];
                    this.filteredEgresados = [...this.egresados];
                    console.log(`‚úÖ [EgresadosManager] ${this.egresados.length} egresados cargados`);

                    this.updateStatistics();
                    this.populateFilters();
                    this.renderTable();

                    if (loadingEl) loadingEl.style.display = 'none';
                    if (this.egresados.length === 0) {
                        if (emptyEl) emptyEl.style.display = 'block';
                    } else {
                        if (tableContainer) tableContainer.style.display = 'block';
                    }
                } else {
                    throw new Error(result.error || 'Error desconocido');
                }
            } catch (error) {
                console.error('‚ùå [EgresadosManager] Error:', error);
                if (loadingEl) loadingEl.style.display = 'none';
                if (errorEl) {
                    errorEl.style.display = 'block';
                    const msgEl = document.getElementById('egresados-error-message');
                    if (msgEl) msgEl.textContent = `Error: ${error.message}`;
                }
            }
        }

        updateStatistics() {
            const total = this.egresados.length;
            const titulados = this.egresados.filter(e => e.estatus_estudios === 'titulado').length;
            const estudiando = this.egresados.filter(e => e.estatus_estudios === 'estudiando').length;
            const conHistoria = this.egresados.filter(e => e.autoriza_publicar === 1 && e.historia_exito).length;

            // Actualizar cards de estad√≠sticas
            this.updateElement('stats-total', total);
            this.updateElement('stats-titulados', titulados);
            this.updateElement('stats-estudiando', estudiando);
            this.updateElement('stats-historias', conHistoria);

            // Actualizar badge en tab
            this.updateElement('egresados-count', total);

            // Actualizar contador en footer
            this.updateElement('total-count', total);

            // Actualizar porcentajes
            if (total > 0) {
                this.updateElement('porcentaje-titulados', `${Math.round((titulados / total) * 100)}%`);
                this.updateElement('porcentaje-estudiando', `${Math.round((estudiando / total) * 100)}%`);
                this.updateElement('porcentaje-historias', `${Math.round((conHistoria / total) * 100)}%`);
            }

            console.log(`üìä [EgresadosManager] Estad√≠sticas actualizadas: ${total} total, ${titulados} titulados, ${estudiando} estudiando`);
        }

        populateFilters() {
            // Llenar generaciones
            const generaciones = [...new Set(this.egresados.map(e => e.generacion))].sort().reverse();
            const selectGen = document.getElementById('filter-generacion');
            if (selectGen) {
                selectGen.innerHTML = '<option value="">Todas las generaciones</option>';
                generaciones.forEach(gen => {
                    const opt = document.createElement('option');
                    opt.value = gen;
                    opt.textContent = `Generaci√≥n ${gen}`;
                    selectGen.appendChild(opt);
                });
            }

            // Llenar estatus din√°micamente
            const estatusUnicos = [...new Set(this.egresados
                .map(e => e.estatus_estudios)
                .filter(e => e !== null && e !== undefined && e !== '')
            )].sort();

            const selectEstatus = document.getElementById('filter-estatus');
            if (selectEstatus) {
                selectEstatus.innerHTML = '<option value="">Todos los estatus</option>';
                estatusUnicos.forEach(estatus => {
                    const opt = document.createElement('option');
                    opt.value = estatus;
                    // Capitalizar y formatear texto
                    opt.textContent = estatus.charAt(0).toUpperCase() + estatus.slice(1);
                    selectEstatus.appendChild(opt);
                });
            }

            console.log(`üîç [EgresadosManager] Filtros poblados: ${generaciones.length} generaciones, ${estatusUnicos.length} estatus`);
        }

        renderTable() {
            const tbody = document.getElementById('egresados-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';
            if (this.filteredEgresados.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="text-center text-muted py-4">
                    <i class="fas fa-search fa-2x mb-2"></i><p>No se encontraron egresados</p></td></tr>`;
                this.updateElement('showing-count', 0);
                return;
            }

            this.filteredEgresados.forEach(egresado => {
                tbody.appendChild(this.createTableRow(egresado));
            });

            this.updateElement('showing-count', this.filteredEgresados.length);
            this.updateElement('total-count', this.egresados.length);
        }

        createTableRow(e) {
            const tr = document.createElement('tr');
            const badges = {'titulado':'success','pasante':'info','estudiando':'primary','trabajando':'warning','otro':'secondary'};
            const badge = badges[e.estatus_estudios] || 'secondary';
            const status = e.estatus_estudios ? e.estatus_estudios.charAt(0).toUpperCase() + e.estatus_estudios.slice(1) : 'N/D';

            tr.innerHTML = `
                <td><strong>${this.esc(e.nombre)}</strong>
                    ${e.historia_exito && e.autoriza_publicar ? '<br><small class="text-muted"><i class="fas fa-star text-warning"></i> Con historia</small>' : ''}
                </td>
                <td>${this.esc(e.generacion || 'N/D')}</td>
                <td><small><i class="fas fa-envelope me-1"></i>${this.esc(e.email || 'N/D')}<br>
                    <i class="fas fa-phone me-1"></i>${this.esc(e.telefono || 'N/D')}</small></td>
                <td>${e.universidad ? '<strong>'+this.esc(e.universidad)+'</strong><br>' : ''}
                    ${e.carrera ? '<small class="text-muted">'+this.esc(e.carrera)+'</small>' : ''}
                    ${e.ocupacion_actual ? '<small class="text-muted">'+this.esc(e.ocupacion_actual)+'</small>' : ''}</td>
                <td><span class="badge bg-${badge}">${status}</span></td>
                <td class="text-center">${e.verificado ?
                    '<i class="fas fa-check-circle text-success"></i>' :
                    '<i class="fas fa-times-circle text-danger"></i>'}</td>
                <td class="text-center">
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" onclick="egresadosManager.showDetail(${e.id})">
                            <i class="fas fa-eye"></i></button>
                        <button class="btn btn-outline-danger" onclick="egresadosManager.confirmDelete(${e.id})">
                            <i class="fas fa-trash"></i></button>
                    </div>
                </td>`;
            return tr;
        }

        showDetail(id) {
            const e = this.egresados.find(x => x.id === id);
            if (!e) return;

            const fecha = e.fecha_registro ? new Date(e.fecha_registro).toLocaleDateString('es-MX') : 'N/D';
            const content = document.getElementById('egresado-detail-content');
            if (!content) return;

            content.innerHTML = `
                <div class="row g-3">
                    <div class="col-md-6">
                        <h6 class="text-primary"><i class="fas fa-user me-2"></i>Informaci√≥n Personal</h6>
                        <table class="table table-sm">
                            <tr><th>Nombre:</th><td>${this.esc(e.nombre)}</td></tr>
                            <tr><th>Email:</th><td>${this.esc(e.email||'N/D')}</td></tr>
                            <tr><th>Tel√©fono:</th><td>${this.esc(e.telefono||'N/D')}</td></tr>
                            <tr><th>Ciudad:</th><td>${this.esc(e.ciudad||'N/D')}</td></tr>
                            <tr><th>Generaci√≥n:</th><td>${this.esc(e.generacion||'N/D')}</td></tr>
                            <tr><th>A√±o Egreso:</th><td>${this.esc(e.a√±o_egreso||'N/D')}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-success"><i class="fas fa-graduation-cap me-2"></i>Formaci√≥n</h6>
                        <table class="table table-sm">
                            <tr><th>Universidad:</th><td>${this.esc(e.universidad||'N/D')}</td></tr>
                            <tr><th>Carrera:</th><td>${this.esc(e.carrera||'N/D')}</td></tr>
                            <tr><th>Estatus:</th><td>${this.esc(e.estatus_estudios||'N/D')}</td></tr>
                            <tr><th>Ocupaci√≥n:</th><td>${this.esc(e.ocupacion_actual||'N/D')}</td></tr>
                            <tr><th>Verificado:</th><td>${e.verificado?'<span class="badge bg-success">S√≠</span>':'<span class="badge bg-danger">No</span>'}</td></tr>
                        </table>
                    </div>
                    ${e.historia_exito ? `<div class="col-12">
                        <h6 class="text-warning"><i class="fas fa-star me-2"></i>Historia de √âxito</h6>
                        <div class="card bg-light"><div class="card-body">
                            <p class="mb-0">${this.esc(e.historia_exito)}</p>
                            ${e.autoriza_publicar?'<small class="text-success"><i class="fas fa-check"></i> Autorizado</small>':'<small class="text-danger"><i class="fas fa-times"></i> No autorizado</small>'}
                        </div></div>
                    </div>` : ''}
                    <div class="col-12">
                        <h6 class="text-info"><i class="fas fa-info-circle me-2"></i>Registro</h6>
                        <small class="text-muted"><strong>Fecha:</strong> ${fecha}<br>
                        <strong>IP:</strong> ${this.esc(e.ip_registro||'N/D')}</small>
                    </div>
                </div>`;

            new bootstrap.Modal(document.getElementById('egresadoDetailModal')).show();
        }

        confirmDelete(id) {
            const e = this.egresados.find(x => x.id === id);
            if (!e || !confirm(`¬øEliminar a "${e.nombre}"?`)) return;
            this.deleteEgresado(id);
        }

        async deleteEgresado(id) {
            try {
                const res = await fetch(`${this.apiBaseUrl}/egresados/${id}`, {method:'DELETE'});
                const result = await res.json();
                if (result.success) {
                    await this.loadEgresados();
                    alert('Egresado eliminado correctamente');
                } else throw new Error(result.error);
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert(`Error: ${error.message}`);
            }
        }

        setupEventListeners() {
            const search = document.getElementById('search-egresado');
            if (search) search.addEventListener('input', () => this.applyFilters());

            const gen = document.getElementById('filter-generacion');
            if (gen) gen.addEventListener('change', () => this.applyFilters());

            const est = document.getElementById('filter-estatus');
            if (est) est.addEventListener('change', () => this.applyFilters());

            const clear = document.getElementById('clear-filters-egresados');
            if (clear) clear.addEventListener('click', () => this.clearFilters());

            const refresh = document.getElementById('refresh-egresados');
            if (refresh) refresh.addEventListener('click', () => this.loadEgresados());
        }

        applyFilters() {
            const search = document.getElementById('search-egresado')?.value.toLowerCase() || '';
            const gen = document.getElementById('filter-generacion')?.value || '';
            const est = document.getElementById('filter-estatus')?.value || '';

            this.filteredEgresados = this.egresados.filter(e => {
                const matchSearch = !search || e.nombre.toLowerCase().includes(search);
                const matchGen = !gen || e.generacion === gen;
                const matchEst = !est || e.estatus_estudios === est;
                return matchSearch && matchGen && matchEst;
            });

            this.renderTable();
        }

        clearFilters() {
            ['search-egresado','filter-generacion','filter-estatus'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            this.filteredEgresados = [...this.egresados];
            this.renderTable();
        }

        updateElement(id, val) {
            const el = document.getElementById(id);
            if (el) el.textContent = val;
        }

        esc(txt) {
            if (!txt) return '';
            return String(txt).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
        }
    }

    // Inicializar
    let egresadosManager;
    document.addEventListener('DOMContentLoaded', function() {
        const tab = document.getElementById('egresados-tab');
        if (tab) {
            tab.addEventListener('shown.bs.tab', async function() {
                if (!egresadosManager) {
                    egresadosManager = new EgresadosManager();
                    await egresadosManager.init();
                }
            });
        }

        // üíº Event listener para tab Bolsa de Trabajo
        const bolsaTrabajoTab = document.getElementById('bolsa-trabajo-tab');
        if (bolsaTrabajoTab) {
            bolsaTrabajoTab.addEventListener('shown.bs.tab', async function() {
                console.log('üíº [TAB] Inicializando Bolsa de Trabajo...');
                if (!window.bolsaManager) {
                    window.bolsaManager = new BolsaTrabajoManager();
                    await window.bolsaManager.init();
                }
            });
        }

        // üìß Event listener para tab Suscriptores
        const suscriptoresTab = document.getElementById('suscriptores-tab');
        if (suscriptoresTab) {
            suscriptoresTab.addEventListener('shown.bs.tab', async function() {
                console.log('üìß [TAB] Inicializando Suscriptores...');
                if (!window.suscriptoresManager) {
                    window.suscriptoresManager = new SuscriptoresManager();
                    await window.suscriptoresManager.init();
                }
            });
        }
    });

    // Funciones globales para onclick handlers
    window.loadEgresados = async function() {
        console.log('üîÑ [loadEgresados] Recargando datos...');
        if (egresadosManager) {
            await egresadosManager.loadEgresados();
        } else {
            console.warn('‚ö†Ô∏è [loadEgresados] egresadosManager no est√° inicializado');
        }
    }

    window.filterEgresados = function() {
        console.log('üîç [filterEgresados] Aplicando filtros...');
        if (egresadosManager) {
            egresadosManager.applyFilters();
        } else {
            console.warn('‚ö†Ô∏è [filterEgresados] egresadosManager no est√° inicializado');
        }
    }

    window.exportEgresados = function() {
        console.log('üì• [exportEgresados] Exportando a CSV...');
        if (egresadosManager) {
            egresadosManager.exportToCSV();
        } else {
            console.warn('‚ö†Ô∏è [exportEgresados] egresadosManager no est√° inicializado');
        }
    }
    </script>

    <!-- Ensure chatbot functions are accessible -->
    <script>
        // Make sure functions are globally accessible if they exist
        if (typeof toggleChatbot !== 'undefined') {
            window.toggleChatbot = toggleChatbot;
        }
        if (typeof sendMessage !== 'undefined') {
            window.sendMessage = sendMessage;
        }
        if (typeof handleKeyPress !== 'undefined') {
            window.handleKeyPress = handleKeyPress;
        }
    </script>
    <!-- ‚úÖ Scripts ya cargados arriba - NO duplicar -->
    <!-- Sistema avanzado de reportes acad√©micos - YA CARGADO ARRIBA -->
    <!-- Container REMOVIDO - Puede estar causando renderizado fuera del layout -->

    <script>
        // ‚úÖ FUNCI√ìN DESACTIVADA TEMPORALMENTE - CAUSABA PROBLEMAS DE LAYOUT
        function initAcademicReportsSystem() {
            console.log('‚ÑπÔ∏è Sistema de reportes acad√©micos avanzado DESACTIVADO - usando sistema integrado del dashboard');
            return false;
        }

        // Funci√≥n para agregar bot√≥n de acceso r√°pido
        function addAcademicReportsButton() {
            const navbar = document.querySelector('.navbar-nav');
            if (navbar) {
                const reportsButton = document.createElement('li');
                reportsButton.className = 'nav-item dropdown';
                reportsButton.innerHTML = `
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-chart-bar"></i> Reportes
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="generateAcademicReport('grades')"><i class="fas fa-graduation-cap"></i> Reporte de Calificaciones</a></li>
                        <li><a class="dropdown-item" href="#" onclick="generateAcademicReport('attendance')"><i class="fas fa-calendar-check"></i> Reporte de Asistencias</a></li>
                        <li><a class="dropdown-item" href="#" onclick="generateAcademicReport('performance')"><i class="fas fa-chart-line"></i> An√°lisis de Rendimiento</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="showReportsManager()"><i class="fas fa-cogs"></i> Gestor de Reportes</a></li>
                    </ul>
                `;
                navbar.appendChild(reportsButton);
                console.log('üìä Bot√≥n de reportes acad√©micos agregado');
            }
        }

        // Funciones para generar reportes espec√≠ficos
        function generateAcademicReport(type) {
            if (window.academicReportsManager) {
                console.log('üìä Generando reporte acad√©mico:', type);
                window.academicReportsManager.generateReport(type);
            } else {
                alert('‚ö†Ô∏è Sistema de reportes no disponible. Reinicia la p√°gina.');
            }
        }

        function showReportsManager() {
            if (window.academicReportsManager) {
                window.academicReportsManager.showManagerInterface();
            } else {
                alert('‚ö†Ô∏è Sistema de reportes no disponible. Reinicia la p√°gina.');
            }
        }

        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initAcademicReportsSystem();
            }, 2000); // Delay para asegurar que todos los scripts est√©n cargados
        });
    </script>
    <script src="js/advanced-metrics-system.js?v=20251001"></script>
    <!-- ‚ùå Mock scripts removidos - archivos no existen -->

    <!-- CSP Universal Fixer - Debe cargar al final -->
    <script src="js/csp-universal-fixer.js?v=20251001"></script>

    <!-- VERIFICACI√ìN ADICIONAL DE AUTENTICACI√ìN AL CARGAR DOM -->
    <script>
        // Verificaci√≥n adicional cuando el DOM est√© completamente cargado
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîí [DASHBOARD SECURITY] Verificaci√≥n adicional de autenticaci√≥n...');
            
            // Verificar nuevamente el estado de autenticaci√≥n
            setTimeout(() => {
                let isAuthenticated = false;
                
                // Verificar con el sistema de autenticaci√≥n si est√° disponible
                if (window.secureAdminAuth && typeof window.secureAdminAuth.isUserAuthenticated === 'function') {
                    isAuthenticated = window.secureAdminAuth.isUserAuthenticated();
                    console.log('üîç [DASHBOARD SECURITY] Verificaci√≥n con secureAdminAuth:', isAuthenticated);
                } else {
                    console.warn('‚ö†Ô∏è [DASHBOARD SECURITY] window.secureAdminAuth no disponible, estado:', window.secureAdminAuth);
                    // Si secureAdminAuth no est√° disponible, intentar inicializarlo
                    if (window.initSecureAuthSystem && typeof window.initSecureAuthSystem === 'function') {
                        console.log('üîÑ [DASHBOARD SECURITY] Inicializando sistema de autenticaci√≥n...');
                        window.initSecureAuthSystem();
                        if (window.secureAdminAuth && typeof window.secureAdminAuth.isUserAuthenticated === 'function') {
                            isAuthenticated = window.secureAdminAuth.isUserAuthenticated();
                            console.log('üîç [DASHBOARD SECURITY] Verificaci√≥n tras inicializaci√≥n:', isAuthenticated);
                        }
                    }
                }
                
                // Verificar localStorage como respaldo
                if (!isAuthenticated) {
                    try {
                        const session = localStorage.getItem('secure_admin_session');
                        if (session) {
                            const sessionData = JSON.parse(session);
                            if (sessionData.token && sessionData.expiresAt && Date.now() < sessionData.expiresAt) {
                                isAuthenticated = true;
                                console.log('‚úÖ [DASHBOARD SECURITY] Sesi√≥n v√°lida en localStorage');
                            } else {
                                console.log('‚è∞ [DASHBOARD SECURITY] Sesi√≥n expirada en localStorage');
                                localStorage.removeItem('secure_admin_session');
                            }
                        }
                    } catch (error) {
                        console.warn('‚ùå [DASHBOARD SECURITY] Error verificando localStorage:', error);
                    }
                }
                
                if (!isAuthenticated) {
                    console.log('üö´ [DASHBOARD SECURITY] Acceso denegado - Usuario no autenticado');
                    window.location.href = 'index.html';
                } else {
                    console.log('‚úÖ [DASHBOARD SECURITY] Acceso confirmado - Usuario autenticado');
                }
            }, 100); // Verificaci√≥n m√°s r√°pida ya que el contenido ya fue validado
        });
    </script>
    
    <!-- Funciones reales del dashboard - Ya no son temporales -->
    <script>
        // Funciones requeridas por onclick events para evitar errores
        function showLoginModal() {
            console.log('üîê Intentando mostrar modal de login...');
            const modal = document.getElementById('loginModal');
            if (modal) {
                console.log('‚úÖ Modal encontrado, mostrando...');
                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();
            } else {
                console.error('‚ùå Modal loginModal no encontrado');
                // Fallback: mostrar alert con datos de prueba
                alert('Modal no encontrado. Datos de prueba:\nUsuario: admin\nContrase√±a: admin123\nRol: Director');
            }
        }

        window.showInfoModal = function() {
            console.log('üîß Abriendo modal de informaci√≥n del sistema...');
            const modal = document.getElementById('infoModal');
            if (modal) {
                console.log('‚úÖ Modal encontrado, actualizando datos y mostrando...');

                // Actualizar estad√≠sticas con datos actuales (localStorage o configurados)
                updateSystemInfoModal();

                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();
            } else {
                console.error('‚ùå Modal infoModal no encontrado');
                // Fallback mejorado
                alert('üìä Sistema de Administraci√≥n BGE H√©roes de la Patria\n\n‚úÖ M√≥dulos Disponibles:\n‚Ä¢ Gesti√≥n de Estudiantes\n‚Ä¢ Control Acad√©mico\n‚Ä¢ Reportes y Estad√≠sticas\n‚Ä¢ Sistema de Pagos\n‚Ä¢ Gesti√≥n de Personal\n‚Ä¢ Configuraci√≥n\n\nüîß Caracter√≠sticas:\n‚Ä¢ Seguridad avanzada\n‚Ä¢ Respaldo autom√°tico\n‚Ä¢ Dise√±o responsivo\n‚Ä¢ Dashboard interactivo');
            }
        }

        function updateSystemInfoModal() {
            try {
                // USAR SISTEMA DIN√ÅMICO - Delegar al dynamic-stats-loader
                if (window.dynamicStatsLoader && window.dynamicStatsLoader.stats) {
                    window.dynamicStatsLoader.updateModalStats();
                    return;
                }

                // Fallback solo si el sistema din√°mico no est√° disponible
                const totalStudents = localStorage.getItem('realData_totalStudents') || '202';
                const totalTeachers = localStorage.getItem('realData_totalTeachers') || '12';
                const totalSubjects = localStorage.getItem('realData_totalSubjects') || '41';
                const generalAverage = localStorage.getItem('realData_generalAverage') || '8.4';

                // Actualizar estad√≠sticas en el modal
                const elements = {
                    'modalTotalStudents': totalStudents,
                    'modalTotalTeachers': totalTeachers,
                    'modalTotalSubjects': totalSubjects,
                    'modalGeneralAverage': generalAverage
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                    }
                });

                // Actualizar informaci√≥n de sesi√≥n
                const currentUser = JSON.parse(localStorage.getItem('secure_admin_session') || '{}');
                if (currentUser.username) {
                    const userNameElement = document.getElementById('currentUserName');
                    const userRoleElement = document.getElementById('currentUserRole');
                    const loginTimeElement = document.getElementById('loginTime');

                    if (userNameElement) userNameElement.textContent = currentUser.name || currentUser.username;
                    if (userRoleElement) userRoleElement.textContent = currentUser.role || 'Administrador';
                    if (loginTimeElement) {
                        const loginTime = new Date(currentUser.loginTime || Date.now()).toLocaleString();
                        loginTimeElement.textContent = loginTime;
                    }
                }

                // Actualizar timestamp
                const lastUpdateElement = document.getElementById('lastUpdate');
                if (lastUpdateElement) {
                    lastUpdateElement.textContent = new Date().toLocaleTimeString();
                }

                console.log('‚úÖ Modal de informaci√≥n actualizado con datos en tiempo real');
            } catch (error) {
                console.error('‚ùå Error actualizando modal de informaci√≥n:', error);
            }
        }

        // Las funciones reales est√°n definidas en dashboard-manager-2025.js
        // Esta secci√≥n ya no bloquea las funcionalidades
        
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            } else {
                // Si no existe la secci√≥n, hacer scroll al panel admin si est√° logueado
                if (adminDashboard && adminDashboard.isLoggedIn) {
                    const adminPanel = document.getElementById('adminPanel');
                    if (adminPanel && !adminPanel.classList.contains('d-none')) {
                        adminPanel.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            }
        }

        // ‚úÖ FUNCIONES DE CAMBIO DE CONTRASE√ëA
        window.showChangePasswordModal = function() {
            console.log('üîë Abriendo modal de cambio de contrase√±a...');
            const modal = document.getElementById('changePasswordModal');
            if (modal) {
                // Limpiar formulario
                document.getElementById('changePasswordForm').reset();
                document.getElementById('passwordChangeMessage').style.display = 'none';
                document.getElementById('passwordStrengthIndicator').style.display = 'none';

                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();
            }
        }

        window.updatePassword = function() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const messageDiv = document.getElementById('passwordChangeMessage');

            // Validaciones
            if (!currentPassword || !newPassword || !confirmPassword) {
                showPasswordMessage('Todos los campos son obligatorios.', 'danger');
                return;
            }

            // Verificar contrase√±a actual (simulado - en producci√≥n ser√≠a contra servidor)
            const storedPassword = localStorage.getItem('admin_password') || 'admin123';
            if (currentPassword !== storedPassword) {
                showPasswordMessage('La contrase√±a actual es incorrecta.', 'danger');
                return;
            }

            // Validar que las nuevas contrase√±as coincidan
            if (newPassword !== confirmPassword) {
                showPasswordMessage('Las nuevas contrase√±as no coinciden.', 'danger');
                return;
            }

            // Validar fortaleza de contrase√±a
            if (newPassword.length < 8) {
                showPasswordMessage('La nueva contrase√±a debe tener al menos 8 caracteres.', 'danger');
                return;
            }

            // Validar que la nueva contrase√±a sea diferente
            if (currentPassword === newPassword) {
                showPasswordMessage('La nueva contrase√±a debe ser diferente a la actual.', 'warning');
                return;
            }

            // Simular actualizaci√≥n (en producci√≥n ser√≠a llamada a servidor)
            try {
                localStorage.setItem('admin_password', newPassword);

                // Registrar en el log de cambios
                const changeLog = JSON.parse(localStorage.getItem('password_changes') || '[]');
                changeLog.push({
                    timestamp: new Date().toISOString(),
                    user: 'admin',
                    action: 'password_changed'
                });
                localStorage.setItem('password_changes', JSON.stringify(changeLog));

                showPasswordMessage('‚úÖ Contrase√±a actualizada exitosamente. Se recomienda cerrar sesi√≥n y volver a iniciarla.', 'success');

                // Limpiar formulario despu√©s de 3 segundos y cerrar modal
                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('changePasswordModal'));
                    modal.hide();
                    document.getElementById('changePasswordForm').reset();
                }, 3000);

            } catch (error) {
                console.error('Error al actualizar contrase√±a:', error);
                showPasswordMessage('Error al actualizar la contrase√±a. Int√©ntelo de nuevo.', 'danger');
            }
        }

        function showPasswordMessage(message, type) {
            const messageDiv = document.getElementById('passwordChangeMessage');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.innerHTML = message;
            messageDiv.style.display = 'block';
        }

        // Validador de fortaleza de contrase√±a en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            const newPasswordField = document.getElementById('newPassword');
            if (newPasswordField) {
                newPasswordField.addEventListener('input', function() {
                    const password = this.value;
                    const strengthIndicator = document.getElementById('passwordStrengthIndicator');
                    const progressBar = strengthIndicator.querySelector('.progress-bar');
                    const strengthText = document.getElementById('strengthText');

                    if (password.length > 0) {
                        strengthIndicator.style.display = 'block';

                        let strength = 0;
                        let feedback = [];

                        // Longitud
                        if (password.length >= 8) strength += 20;
                        else feedback.push('m√≠nimo 8 caracteres');

                        // Letras may√∫sculas
                        if (/[A-Z]/.test(password)) strength += 20;
                        else feedback.push('may√∫sculas');

                        // Letras min√∫sculas
                        if (/[a-z]/.test(password)) strength += 20;
                        else feedback.push('min√∫sculas');

                        // N√∫meros
                        if (/\d/.test(password)) strength += 20;
                        else feedback.push('n√∫meros');

                        // Caracteres especiales
                        if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 20;
                        else feedback.push('s√≠mbolos');

                        // Actualizar barra de progreso
                        progressBar.style.width = strength + '%';

                        if (strength < 40) {
                            progressBar.className = 'progress-bar bg-danger';
                            strengthText.textContent = `D√©bil - Falta: ${feedback.join(', ')}`;
                        } else if (strength < 80) {
                            progressBar.className = 'progress-bar bg-warning';
                            strengthText.textContent = `Medio - Falta: ${feedback.join(', ')}`;
                        } else {
                            progressBar.className = 'progress-bar bg-success';
                            strengthText.textContent = 'Fuerte - Contrase√±a segura';
                        }
                    } else {
                        strengthIndicator.style.display = 'none';
                    }
                });
            }
        });

        // ‚úÖ FUNCIONES DE CONFIGURACI√ìN DE ESTAD√çSTICAS
        window.showStatisticsConfigModal = function() {
            console.log('üìä Abriendo modal de configuraci√≥n de estad√≠sticas...');
            const modal = document.getElementById('statisticsConfigModal');
            if (modal) {
                // Cargar valores actuales desde localStorage o defaults
                document.getElementById('configTotalStudents').value = localStorage.getItem('realData_totalStudents') || '1247';
                document.getElementById('configTotalTeachers').value = localStorage.getItem('realData_totalTeachers') || '68';
                document.getElementById('configTotalSubjects').value = localStorage.getItem('realData_totalSubjects') || '42';
                document.getElementById('configGeneralAverage').value = localStorage.getItem('realData_generalAverage') || '8.4';

                // Limpiar mensajes
                document.getElementById('statisticsConfigMessage').style.display = 'none';

                const modalInstance = new bootstrap.Modal(modal);
                modalInstance.show();
            }
        }

        window.saveStatisticsConfig = function() {
            const students = document.getElementById('configTotalStudents').value;
            const teachers = document.getElementById('configTotalTeachers').value;
            const subjects = document.getElementById('configTotalSubjects').value;
            const average = document.getElementById('configGeneralAverage').value;
            const messageDiv = document.getElementById('statisticsConfigMessage');

            // Validaciones
            if (!students || !teachers || !subjects || !average) {
                showStatisticsMessage('Todos los campos son obligatorios.', 'danger');
                return;
            }

            // Validar valores num√©ricos
            const studentsNum = parseInt(students);
            const teachersNum = parseInt(teachers);
            const subjectsNum = parseInt(subjects);
            const averageNum = parseFloat(average);

            if (studentsNum < 0 || studentsNum > 9999) {
                showStatisticsMessage('El n√∫mero de estudiantes debe estar entre 0 y 9999.', 'warning');
                return;
            }

            if (teachersNum < 0 || teachersNum > 999) {
                showStatisticsMessage('El n√∫mero de docentes debe estar entre 0 y 999.', 'warning');
                return;
            }

            if (subjectsNum < 0 || subjectsNum > 999) {
                showStatisticsMessage('El n√∫mero de materias debe estar entre 0 y 999.', 'warning');
                return;
            }

            if (averageNum < 0 || averageNum > 10) {
                showStatisticsMessage('El promedio debe estar entre 0 y 10.', 'warning');
                return;
            }

            try {
                // Guardar en localStorage
                localStorage.setItem('realData_totalStudents', students);
                localStorage.setItem('realData_totalTeachers', teachers);
                localStorage.setItem('realData_totalSubjects', subjects);
                localStorage.setItem('realData_generalAverage', average);

                // Registrar cambio en log
                const configLog = JSON.parse(localStorage.getItem('statistics_changes') || '[]');
                configLog.push({
                    timestamp: new Date().toISOString(),
                    user: 'admin',
                    action: 'statistics_updated',
                    data: { students, teachers, subjects, average }
                });
                localStorage.setItem('statistics_changes', JSON.stringify(configLog));

                // Actualizar los valores en todas las pantallas
                updateAllStatisticsDisplays(studentsNum, teachersNum, subjectsNum, averageNum);

                showStatisticsMessage('‚úÖ Estad√≠sticas actualizadas exitosamente. Los cambios son permanentes.', 'success');

                // Cerrar modal despu√©s de 3 segundos
                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('statisticsConfigModal'));
                    modal.hide();
                }, 3000);

            } catch (error) {
                console.error('Error al guardar estad√≠sticas:', error);
                showStatisticsMessage('Error al guardar las estad√≠sticas. Int√©ntelo de nuevo.', 'danger');
            }
        }

        function showStatisticsMessage(message, type) {
            const messageDiv = document.getElementById('statisticsConfigMessage');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.innerHTML = message;
            messageDiv.style.display = 'block';
        }

        function updateAllStatisticsDisplays(students, teachers, subjects, average) {
            // Actualizar las tarjetas principales del dashboard
            const studentsCard = document.getElementById('totalStudents');
            const teachersCard = document.getElementById('totalTeachers');
            const subjectsCard = document.getElementById('totalSubjects');
            const averageCard = document.getElementById('generalAverage');

            if (studentsCard) studentsCard.textContent = students.toLocaleString();
            if (teachersCard) teachersCard.textContent = teachers.toLocaleString();
            if (subjectsCard) subjectsCard.textContent = subjects.toLocaleString();
            if (averageCard) averageCard.textContent = average;

            // Actualizar modal de informaci√≥n del sistema
            const modalStudents = document.getElementById('modalTotalStudents');
            const modalTeachers = document.getElementById('modalTotalTeachers');
            const modalSubjects = document.getElementById('modalTotalSubjects');
            const modalAverage = document.getElementById('modalGeneralAverage');

            if (modalStudents) modalStudents.textContent = students.toLocaleString();
            if (modalTeachers) modalTeachers.textContent = teachers.toLocaleString();
            if (modalSubjects) modalSubjects.textContent = subjects.toLocaleString();
            if (modalAverage) modalAverage.textContent = average;

            // Actualizar instancia del dashboard si existe
            if (window.adminDashboard && window.adminDashboard.realDataConfig) {
                window.adminDashboard.realDataConfig.totalStudents = students;
                window.adminDashboard.realDataConfig.totalTeachers = teachers;
                window.adminDashboard.realDataConfig.totalSubjects = subjects;
                window.adminDashboard.realDataConfig.generalAverage = average;

                // Refrescar dashboard si tiene m√©todo de actualizaci√≥n
                if (typeof window.adminDashboard.updateDashboardUI === 'function') {
                    window.adminDashboard.updateDashboardUI();
                }
            }

            console.log('üìä Estad√≠sticas actualizadas:', { students, teachers, subjects, average });
        }

        // ‚úÖ FUNCIONES DEL CHATBOT
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbot');
            if (chatbot) {
                if (chatbot.style.display === 'none' || chatbot.style.display === '') {
                    chatbot.style.display = 'flex';
                    console.log('ü§ñ Chatbot abierto');
                } else {
                    chatbot.style.display = 'none';
                    console.log('ü§ñ Chatbot cerrado');
                }
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();

            if (!message) return;

            const messagesContainer = document.getElementById('chatbotMessages');

            // Agregar mensaje del usuario
            const userMessage = document.createElement('div');
            userMessage.className = 'chatbot-message user';
            userMessage.innerHTML = `<div class="message-text">${message}</div>`;
            messagesContainer.appendChild(userMessage);

            // Limpiar input
            input.value = '';

            // Mostrar indicador de escritura
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.style.display = 'block';
            }

            // Scroll al final
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Simular respuesta del bot despu√©s de un delay
            setTimeout(() => {
                if (typingIndicator) {
                    typingIndicator.style.display = 'none';
                }

                const botResponse = generateBotResponse(message);
                const botMessage = document.createElement('div');
                botMessage.className = 'chatbot-message bot';
                botMessage.innerHTML = botResponse;
                messagesContainer.appendChild(botMessage);

                // Scroll al final
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 1500);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        }

        function generateBotResponse(userMessage) {
            const message = userMessage.toLowerCase();

            // Respuestas espec√≠ficas para el contexto educativo
            if (message.includes('horario') || message.includes('hora')) {
                return `<div class="response-professional">
                    <div class="response-title">üìÖ Horarios Escolares</div>
                    <div class="response-content">
                        <div class="response-section">
                            <div class="response-subtitle">Horario de Clases</div>
                            <div class="response-text">‚Ä¢ Lunes a Viernes: 7:00 AM - 2:00 PM<br>‚Ä¢ Recreo: 10:30 - 11:00 AM<br>‚Ä¢ Almuerzo: 12:30 - 1:00 PM</div>
                        </div>
                    </div>
                </div>`;
            }

            if (message.includes('beca') || message.includes('apoyo')) {
                return `<div class="response-professional">
                    <div class="response-title">üí∞ Becas y Apoyos</div>
                    <div class="response-content">
                        <div class="response-section">
                            <div class="response-subtitle">Programas Disponibles</div>
                            <div class="response-text">‚Ä¢ Beca de Excelencia Acad√©mica<br>‚Ä¢ Apoyo Socioecon√≥mico<br>‚Ä¢ Beca Deportiva<br>‚Ä¢ Beca Cultural</div>
                        </div>
                    </div>
                    <div class="response-footer">Para m√°s informaci√≥n, contacta a la oficina de Servicios Estudiantiles.</div>
                </div>`;
            }

            if (message.includes('carrera') || message.includes('especialidad')) {
                return `<div class="response-professional">
                    <div class="response-title">üéì Especialidades BGE</div>
                    <div class="response-content">
                        <div class="response-section">
                            <div class="response-subtitle">√Åreas de Formaci√≥n</div>
                            <div class="response-text">‚Ä¢ F√≠sico-Matem√°ticas<br>‚Ä¢ Qu√≠mico-Biol√≥gicas<br>‚Ä¢ Humanidades<br>‚Ä¢ Ciencias Sociales</div>
                        </div>
                    </div>
                </div>`;
            }

            if (message.includes('requisito') || message.includes('inscripcion')) {
                return `<div class="response-professional">
                    <div class="response-title">üìã Requisitos de Inscripci√≥n</div>
                    <div class="response-content">
                        <div class="response-section">
                            <div class="response-subtitle">Documentos Necesarios</div>
                            <div class="response-text">‚Ä¢ Certificado de Secundaria<br>‚Ä¢ Acta de Nacimiento<br>‚Ä¢ CURP<br>‚Ä¢ 6 fotograf√≠as tama√±o infantil<br>‚Ä¢ Comprobante de domicilio</div>
                        </div>
                    </div>
                </div>`;
            }

            if (message.includes('contacto') || message.includes('telefono') || message.includes('direccion')) {
                return `<div class="response-professional">
                    <div class="response-title">üìû Informaci√≥n de Contacto</div>
                    <div class="response-content">
                        <div class="response-section">
                            <div class="response-subtitle">Datos de Contacto</div>
                            <div class="response-text">‚Ä¢ Tel√©fono: (555) 123-4567<br>‚Ä¢ Email: info@bgeheroes.edu.mx<br>‚Ä¢ Direcci√≥n: Av. H√©roes #123, Centro</div>
                        </div>
                    </div>
                </div>`;
            }

            // Respuesta por defecto
            return `<div class="response-professional">
                <div class="response-title">ü§ñ Asistente Virtual</div>
                <div class="response-content">
                    <div class="response-section">
                        <div class="response-subtitle">¬øTe puedo ayudar con algo m√°s espec√≠fico?</div>
                        <div class="response-text">Puedo ayudarte con informaci√≥n sobre:<br>‚Ä¢ Horarios y calendarios<br>‚Ä¢ Becas y apoyos<br>‚Ä¢ Especialidades acad√©micas<br>‚Ä¢ Requisitos de inscripci√≥n<br>‚Ä¢ Informaci√≥n de contacto</div>
                    </div>
                </div>
                <div class="response-footer">¬øHay algo espec√≠fico que te interese saber?</div>
            </div>`;
        }
    </script>

    <!-- Dark Mode Styles & Script -->
    <style>
        .dark-mode-toggle {
            position: fixed;
            bottom: 6rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bs-primary);
            color: white;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dark-mode-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        body.dark-mode {
            background-color: #1a1a1a !important;
            color: #ffffff !important;
        }

        body.dark-mode .bg-light {
            background-color: #2d2d2d !important;
        }

        body.dark-mode .card {
            background-color: #2d2d2d !important;
            border-color: #404040 !important;
            color: #ffffff !important;
        }

        body.dark-mode .text-muted {
            color: #b0b0b0 !important;
        }

        body.dark-mode .text-dark {
            color: #ffffff !important;
        }

        body.dark-mode .table {
            background-color: #2d2d2d !important;
            color: #ffffff !important;
        }

        body.dark-mode .table td,
        body.dark-mode .table th {
            border-color: #404040 !important;
        }

        body.dark-mode .form-control,
        body.dark-mode .form-select {
            background-color: #404040 !important;
            border-color: #505050 !important;
            color: #ffffff !important;
        }

        /* Fix para t√≠tulos visibles */
        body.dark-mode h2.text-dark {
            color: #ffffff !important;
        }
        
        h2.text-dark {
            color: #212529 !important;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const body = document.body;
            
            if (localStorage.getItem('darkMode') === 'enabled') {
                body.classList.add('dark-mode');
                updateDarkModeIcon(true);
            }
            
            darkModeToggle.addEventListener('click', (e) => {
                e.preventDefault();
                body.classList.toggle('dark-mode');
                
                if (body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', 'enabled');
                    updateDarkModeIcon(true);
                } else {
                    localStorage.setItem('darkMode', 'disabled');
                    updateDarkModeIcon(false);
                }
            });
            
            function updateDarkModeIcon(isDark) {
                if (darkModeToggle) {
                    let icon = darkModeToggle.querySelector('i');
                    if (icon) {
                        icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
                    }
                }
            }
        });
    </script>

    <!-- üîê SISTEMA DE SEGURIDAD AUTOM√ÅTICA AVANZADO - PROTECCI√ìN COMPLETA -->
    <script>
        (function() {
            'use strict';

            let lastSessionCheck = null;
            let isRedirecting = false;
            let hasEverBeenAuthenticated = false;

            // üö® VERIFICACI√ìN INMEDIATA AL CARGAR LA P√ÅGINA
            function immediateSecurityCheck() {
                console.log('üîç [SECURITY] Verificaci√≥n inmediata de seguridad...');

                const session = localStorage.getItem('secure_admin_session');
                const hasValidAuth = window.secureAdminAuth &&
                    typeof window.secureAdminAuth.isUserAuthenticated === 'function' &&
                    window.secureAdminAuth.isUserAuthenticated();

                // Si no hay sesi√≥n v√°lida, bloquear inmediatamente
                if (!session && !hasValidAuth) {
                    console.log('üö® [SECURITY] Acceso no autorizado detectado - Bloqueando p√°gina');
                    blockPageAndRedirect('Acceso no autorizado');
                    return false;
                }

                hasEverBeenAuthenticated = true;
                return true;
            }

            function blockPageAndRedirect(reason) {
                if (isRedirecting) return;
                isRedirecting = true;

                console.log(`üö® [SECURITY ALERT] ${reason}. Bloqueando y redirigiendo...`);

                // Bloquear toda la p√°gina inmediatamente
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                    background: rgba(0,0,0,0.9); z-index: 999998;
                    display: flex; align-items: center; justify-content: center;
                `;

                // Mostrar notificaci√≥n de seguridad
                const notification = document.createElement('div');
                notification.style.cssText = `
                    background: #dc3545; color: white; padding: 30px; border-radius: 12px;
                    text-align: center; max-width: 400px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
                `;
                notification.innerHTML = `
                    <i class="fas fa-shield-alt fa-3x mb-3"></i>
                    <h3>üîê Seguridad Activada</h3>
                    <p><strong>Motivo:</strong> ${reason}</p>
                    <p>Redirigiendo por seguridad...</p>
                    <div class="spinner-border text-light mt-3" role="status">
                        <span class="visually-hidden">Redirigiendo...</span>
                    </div>
                `;

                overlay.appendChild(notification);
                document.body.appendChild(overlay);

                // Ocultar todo el contenido de la p√°gina
                document.body.style.overflow = 'hidden';
                const mainContent = document.querySelector('main');
                if (mainContent) mainContent.style.display = 'none';

                // Redirigir despu√©s de un breve delay
                setTimeout(() => {
                    window.location.replace('index.html'); // replace evita volver con bot√≥n atr√°s
                }, 2000);
            }

            function checkSessionAndRedirect() {
                // Solo ejecutar si no estamos en proceso de redirecci√≥n
                if (isRedirecting) return;

                try {
                    // Verificar m√∫ltiples formas de detectar cierre de sesi√≥n
                    let isLoggedOut = false;

                    // 1. Verificar localStorage
                    const session = localStorage.getItem('secure_admin_session');
                    if (!session && hasEverBeenAuthenticated) {
                        console.log('üîí [SECURITY] LocalStorage session eliminada');
                        isLoggedOut = true;
                    }

                    // 2. Verificar si el sistema de autenticaci√≥n reporta logout
                    if (window.secureAdminAuth && typeof window.secureAdminAuth.isUserAuthenticated === 'function') {
                        const authStatus = window.secureAdminAuth.isUserAuthenticated();
                        if (!authStatus && hasEverBeenAuthenticated) {
                            console.log('üîí [SECURITY] Sistema de autenticaci√≥n reporta logout');
                            isLoggedOut = true;
                        }
                    }

                    // 3. Verificar si hay cambios en el estado
                    const currentSession = localStorage.getItem('secure_admin_session');
                    if (lastSessionCheck !== null && lastSessionCheck !== currentSession) {
                        console.log('üîí [SECURITY] Cambio detectado en sesi√≥n');
                        if (!currentSession && hasEverBeenAuthenticated) {
                            isLoggedOut = true;
                        }
                    }
                    lastSessionCheck = currentSession;

                    // 4. Verificar notificaci√≥n de cierre en ventana
                    if (sessionStorage.getItem('admin_logout_redirect') === 'true') {
                        console.log('üîí [SECURITY] Se√±al de logout detectada');
                        sessionStorage.removeItem('admin_logout_redirect');
                        isLoggedOut = true;
                    }

                    // Si se detect√≥ cierre de sesi√≥n, bloquear inmediatamente
                    if (isLoggedOut) {
                        blockPageAndRedirect('Sesi√≥n cerrada');
                    }

                } catch (error) {
                    console.error('üö® [SECURITY ERROR]', error);
                }
            }

            // üõ°Ô∏è PROTECCI√ìN CONTRA BOT√ìN DE RETROCESO
            function preventBackNavigation() {
                // Agregar entrada al historial para evitar retroceso directo
                history.pushState(null, null, location.href);

                // Interceptar evento de retroceso
                window.addEventListener('popstate', function(event) {
                    console.log('üîí [SECURITY] Intento de retroceso detectado');

                    // Verificar inmediatamente la sesi√≥n
                    const session = localStorage.getItem('secure_admin_session');
                    const hasValidAuth = window.secureAdminAuth &&
                        typeof window.secureAdminAuth.isUserAuthenticated === 'function' &&
                        window.secureAdminAuth.isUserAuthenticated();

                    if (!session && !hasValidAuth) {
                        console.log('üö® [SECURITY] Retroceso sin autenticaci√≥n - Bloqueando');
                        blockPageAndRedirect('Navegaci√≥n no autorizada');
                    } else {
                        // Si hay sesi√≥n v√°lida, permitir pero mantener en la misma p√°gina
                        history.pushState(null, null, location.href);
                    }
                });
            }

            // üöÄ INICIALIZACI√ìN DEL SISTEMA DE SEGURIDAD
            document.addEventListener('DOMContentLoaded', function() {
                // Verificaci√≥n inmediata
                if (!immediateSecurityCheck()) {
                    return; // Ya se est√° redirigiendo
                }

                // Activar protecci√≥n contra retroceso
                preventBackNavigation();

                // üîß OPTIMIZADO: Page Visibility API para pausar cuando la p√°gina no est√° visible
                let securityInterval = null;
                let isPageVisible = !document.hidden;

                function startSecurityCheck() {
                    // Solo iniciar si no hay un intervalo activo y la p√°gina es visible
                    if (!securityInterval && isPageVisible && !isRedirecting) {
                        // Verificaci√≥n cada 5 segundos en lugar de cada 1 segundo (500% m√°s eficiente)
                        securityInterval = setInterval(checkSessionAndRedirect, 5000);
                        console.log('üõ°Ô∏è [SECURITY] Verificaci√≥n de seguridad iniciada (cada 5s)');
                    }
                }

                function stopSecurityCheck() {
                    if (securityInterval) {
                        clearInterval(securityInterval);
                        securityInterval = null;
                        console.log('‚è∏Ô∏è [SECURITY] Verificaci√≥n de seguridad pausada');
                    }
                }

                // Manejar cambios de visibilidad de la p√°gina (Page Visibility API)
                document.addEventListener('visibilitychange', function() {
                    isPageVisible = !document.hidden;

                    if (isPageVisible) {
                        console.log('üëÅÔ∏è [SECURITY] P√°gina visible - Verificando sesi√≥n y reanudando checks');
                        checkSessionAndRedirect(); // Verificaci√≥n inmediata al volver
                        startSecurityCheck();
                    } else {
                        console.log('üôà [SECURITY] P√°gina oculta - Pausando verificaci√≥n peri√≥dica');
                        stopSecurityCheck();
                    }
                });

                // Iniciar verificaci√≥n solo si la p√°gina es visible
                if (isPageVisible) {
                    startSecurityCheck();
                }

                // Verificar tambi√©n cuando se enfoca la ventana
                window.addEventListener('focus', function() {
                    if (!isRedirecting) {
                        checkSessionAndRedirect();
                    }
                });

                // Verificar cuando hay cambios en localStorage desde otras pesta√±as
                window.addEventListener('storage', function(e) {
                    if (e.key === 'secure_admin_session' && !e.newValue) {
                        console.log('üîí [SECURITY] Logout detectado desde otra pesta√±a');
                        blockPageAndRedirect('Sesi√≥n cerrada en otra pesta√±a');
                    }
                });

                // Cleanup al salir de la p√°gina
                window.addEventListener('beforeunload', function() {
                    stopSecurityCheck();
                });

                console.log('üõ°Ô∏è [SECURITY SYSTEM] Sistema de seguridad optimizado activado');
            });

            // Ejecutar verificaci√≥n inmediata incluso antes del DOMContentLoaded
            immediateSecurityCheck();

        })();
    </script>

    <!-- MODALES DE GESTI√ìN DE CONTENIDO -->

    <!-- Modal Gesti√≥n Noticias -->
    <div class="modal fade" id="noticiasModal" tabindex="-1" aria-labelledby="noticiasModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="noticiasModalLabel">
                        <i class="fas fa-newspaper me-2"></i>Gesti√≥n de Noticias
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-plus-circle me-2"></i>Nueva Noticia
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <form id="noticiaForm">
                                        <div class="mb-3">
                                            <label for="noticiaId" class="form-label">ID</label>
                                            <input type="text" class="form-control" id="noticiaId" placeholder="Se genera autom√°ticamente" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label for="noticiaTitulo" class="form-label">T√≠tulo *</label>
                                            <input type="text" class="form-control" id="noticiaTitulo" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="noticiaResumen" class="form-label">Resumen</label>
                                            <textarea class="form-control" id="noticiaResumen" rows="2" placeholder="Breve resumen de la noticia"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="noticiaContenido" class="form-label">Contenido *</label>
                                            <textarea class="form-control" id="noticiaContenido" rows="4" required></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="noticiaAutor" class="form-label">Autor *</label>
                                            <input type="text" class="form-control" id="noticiaAutor" required>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="noticiaFecha" class="form-label">Fecha *</label>
                                                    <input type="date" class="form-control" id="noticiaFecha" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="noticiaCategoria" class="form-label">Categor√≠a *</label>
                                                    <select class="form-select" id="noticiaCategoria" required>
                                                        <option value="">Seleccionar...</option>
                                                        <option value="acad√©mico">Acad√©mico</option>
                                                        <option value="administrativo">Administrativo</option>
                                                        <option value="cultural">Cultural</option>
                                                        <option value="deportivo">Deportivo</option>
                                                        <option value="social">Social</option>
                                                        <option value="general">General</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="noticiaImagen" class="form-label">Imagen (URL)</label>
                                            <input type="text" class="form-control" id="noticiaImagen" placeholder="images/noticias/imagen.jpg">
                                        </div>
                                        <div class="mb-3">
                                            <label for="noticiaTags" class="form-label">Tags (separados por comas)</label>
                                            <input type="text" class="form-control" id="noticiaTags" placeholder="educaci√≥n, estudiantes, eventos">
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="noticiaDestacado">
                                                    <label class="form-check-label" for="noticiaDestacado">Destacada</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="noticiaActivo" checked>
                                                    <label class="form-check-label" for="noticiaActivo">Activa</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-grid gap-2 mt-3">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i>Guardar Noticia
                                            </button>
                                            <button type="button" class="btn btn-secondary" onclick="clearNoticiaForm()">
                                                <i class="fas fa-broom me-2"></i>Limpiar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-list me-2"></i>Noticias Existentes
                                    </h6>
                                    <button class="btn btn-sm btn-outline-primary" onclick="refreshNoticiasList()">
                                        <i class="fas fa-sync-alt"></i> Actualizar
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div id="noticiasContainer" class="table-responsive">
                                        <div class="text-center p-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-2">Cargando noticias...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gesti√≥n Eventos -->
    <div class="modal fade" id="eventosModal" tabindex="-1" aria-labelledby="eventosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="eventosModalLabel">
                        <i class="fas fa-calendar-alt me-2"></i>Gesti√≥n de Eventos
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-plus-circle me-2"></i>Nuevo Evento
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <form id="eventoForm">
                                        <div class="mb-3">
                                            <label for="eventoId" class="form-label">ID</label>
                                            <input type="text" class="form-control" id="eventoId" placeholder="Se genera autom√°ticamente" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label for="eventoTitulo" class="form-label">T√≠tulo *</label>
                                            <input type="text" class="form-control" id="eventoTitulo" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="eventoDescripcion" class="form-label">Descripci√≥n *</label>
                                            <textarea class="form-control" id="eventoDescripcion" rows="3" required></textarea>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="eventoFecha" class="form-label">Fecha *</label>
                                                    <input type="date" class="form-control" id="eventoFecha" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="eventoHora" class="form-label">Hora *</label>
                                                    <input type="time" class="form-control" id="eventoHora" required>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="eventoLugar" class="form-label">Lugar *</label>
                                            <input type="text" class="form-control" id="eventoLugar" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="eventoOrganizador" class="form-label">Organizador *</label>
                                            <input type="text" class="form-control" id="eventoOrganizador" required>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="eventoCategoria" class="form-label">Categor√≠a *</label>
                                                    <select class="form-select" id="eventoCategoria" required>
                                                        <option value="">Seleccionar...</option>
                                                        <option value="acad√©mico">Acad√©mico</option>
                                                        <option value="cultural">Cultural</option>
                                                        <option value="deportivo">Deportivo</option>
                                                        <option value="social">Social</option>
                                                        <option value="institucional">Institucional</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="eventoCupo" class="form-label">Cupo M√°ximo</label>
                                                    <input type="number" class="form-control" id="eventoCupo" min="1">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="eventoContacto" class="form-label">Contacto</label>
                                            <input type="email" class="form-control" id="eventoContacto" placeholder="contacto@ejemplo.com">
                                        </div>
                                        <div class="mb-3">
                                            <label for="eventoImagen" class="form-label">Imagen (URL)</label>
                                            <input type="text" class="form-control" id="eventoImagen" placeholder="images/eventos/evento.jpg">
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="eventoInscripcion">
                                                    <label class="form-check-label" for="eventoInscripcion">Requiere inscripci√≥n</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="eventoDestacado">
                                                    <label class="form-check-label" for="eventoDestacado">Destacado</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-check mt-2">
                                            <input class="form-check-input" type="checkbox" id="eventoActivo" checked>
                                            <label class="form-check-label" for="eventoActivo">Activo</label>
                                        </div>
                                        <div class="d-grid gap-2 mt-3">
                                            <button type="submit" class="btn btn-success">
                                                <i class="fas fa-save me-2"></i>Guardar Evento
                                            </button>
                                            <button type="button" class="btn btn-secondary" onclick="clearEventoForm()">
                                                <i class="fas fa-broom me-2"></i>Limpiar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-list me-2"></i>Eventos Existentes
                                    </h6>
                                    <button class="btn btn-sm btn-outline-success" onclick="refreshEventosList()">
                                        <i class="fas fa-sync-alt"></i> Actualizar
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div id="eventosContainer" class="table-responsive">
                                        <div class="text-center p-4">
                                            <div class="spinner-border text-success" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-2">Cargando eventos...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gesti√≥n Avisos -->
    <div class="modal fade" id="avisosModal" tabindex="-1" aria-labelledby="avisosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="avisosModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>Gesti√≥n de Avisos
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-plus-circle me-2"></i>Nuevo Aviso
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <form id="avisoForm">
                                        <div class="mb-3">
                                            <label for="avisoId" class="form-label">ID</label>
                                            <input type="text" class="form-control" id="avisoId" placeholder="Se genera autom√°ticamente" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label for="avisoTitulo" class="form-label">T√≠tulo *</label>
                                            <input type="text" class="form-control" id="avisoTitulo" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="avisoContenido" class="form-label">Contenido *</label>
                                            <textarea class="form-control" id="avisoContenido" rows="4" required></textarea>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="avisoTipo" class="form-label">Tipo *</label>
                                                    <select class="form-select" id="avisoTipo" required>
                                                        <option value="">Seleccionar...</option>
                                                        <option value="importante">Importante</option>
                                                        <option value="informativo">Informativo</option>
                                                        <option value="recordatorio">Recordatorio</option>
                                                        <option value="urgente">Urgente</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="avisoPrioridad" class="form-label">Prioridad *</label>
                                                    <select class="form-select" id="avisoPrioridad" required>
                                                        <option value="">Seleccionar...</option>
                                                        <option value="alta">Alta</option>
                                                        <option value="media">Media</option>
                                                        <option value="baja">Baja</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="avisoFechaInicio" class="form-label">Fecha Inicio *</label>
                                                    <input type="date" class="form-control" id="avisoFechaInicio" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="avisoFechaFin" class="form-label">Fecha Fin</label>
                                                    <input type="date" class="form-control" id="avisoFechaFin">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="avisoDirigidoA" class="form-label">Dirigido a *</label>
                                            <select class="form-select" id="avisoDirigidoA" required>
                                                <option value="">Seleccionar...</option>
                                                <option value="toda la comunidad">Toda la comunidad</option>
                                                <option value="estudiantes">Estudiantes</option>
                                                <option value="docentes">Docentes</option>
                                                <option value="personal administrativo">Personal administrativo</option>
                                                <option value="padres de familia">Padres de familia</option>
                                                <option value="estudiantes becarios">Estudiantes becarios</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="avisoContacto" class="form-label">Contacto</label>
                                            <input type="email" class="form-control" id="avisoContacto" placeholder="contacto@ejemplo.com">
                                        </div>
                                        <div class="mb-3">
                                            <label for="avisoImagen" class="form-label">Imagen (URL)</label>
                                            <input type="text" class="form-control" id="avisoImagen" placeholder="images/avisos/aviso.jpg">
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="avisoActivo" checked>
                                            <label class="form-check-label" for="avisoActivo">Activo</label>
                                        </div>
                                        <div class="d-grid gap-2 mt-3">
                                            <button type="submit" class="btn btn-warning">
                                                <i class="fas fa-save me-2"></i>Guardar Aviso
                                            </button>
                                            <button type="button" class="btn btn-secondary" onclick="clearAvisoForm()">
                                                <i class="fas fa-broom me-2"></i>Limpiar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-list me-2"></i>Avisos Existentes
                                    </h6>
                                    <button class="btn btn-sm btn-outline-warning" onclick="refreshAvisosList()">
                                        <i class="fas fa-sync-alt"></i> Actualizar
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div id="avisosContainer" class="table-responsive">
                                        <div class="text-center p-4">
                                            <div class="spinner-border text-warning" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-2">Cargando avisos...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gesti√≥n Comunicados -->
    <div class="modal fade" id="comunicadosModal" tabindex="-1" aria-labelledby="comunicadosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="comunicadosModalLabel">
                        <i class="fas fa-file-alt me-2"></i>Gesti√≥n de Comunicados
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-plus-circle me-2"></i>Nuevo Comunicado
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <form id="comunicadoForm">
                                        <div class="mb-3">
                                            <label for="comunicadoId" class="form-label">ID</label>
                                            <input type="text" class="form-control" id="comunicadoId" placeholder="Se genera autom√°ticamente" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label for="comunicadoTitulo" class="form-label">T√≠tulo *</label>
                                            <input type="text" class="form-control" id="comunicadoTitulo" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="comunicadoContenido" class="form-label">Contenido *</label>
                                            <textarea class="form-control" id="comunicadoContenido" rows="4" required></textarea>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="comunicadoEmisor" class="form-label">Emisor *</label>
                                                    <select class="form-select" id="comunicadoEmisor" required>
                                                        <option value="">Seleccionar...</option>
                                                        <option value="Direcci√≥n General">Direcci√≥n General</option>
                                                        <option value="Direcci√≥n Acad√©mica">Direcci√≥n Acad√©mica</option>
                                                        <option value="Servicios Estudiantiles">Servicios Estudiantiles</option>
                                                        <option value="Coordinaci√≥n Acad√©mica">Coordinaci√≥n Acad√©mica</option>
                                                        <option value="Subdirecci√≥n">Subdirecci√≥n</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="comunicadoTipo" class="form-label">Tipo *</label>
                                                    <select class="form-select" id="comunicadoTipo" required>
                                                        <option value="">Seleccionar...</option>
                                                        <option value="oficial">Oficial</option>
                                                        <option value="informativo">Informativo</option>
                                                        <option value="convocatoria">Convocatoria</option>
                                                        <option value="circular">Circular</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="comunicadoFecha" class="form-label">Fecha Emisi√≥n *</label>
                                                    <input type="date" class="form-control" id="comunicadoFecha" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="comunicadoVigencia" class="form-label">Vigencia</label>
                                                    <input type="text" class="form-control" id="comunicadoVigencia" placeholder="permanente, temporal, fecha">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="comunicadoPrioridad" class="form-label">Prioridad *</label>
                                            <select class="form-select" id="comunicadoPrioridad" required>
                                                <option value="">Seleccionar...</option>
                                                <option value="alta">Alta</option>
                                                <option value="media">Media</option>
                                                <option value="baja">Baja</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="comunicadoDestinatarios" class="form-label">Destinatarios *</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="estudiantes" id="dest_estudiantes">
                                                <label class="form-check-label" for="dest_estudiantes">Estudiantes</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="docentes" id="dest_docentes">
                                                <label class="form-check-label" for="dest_docentes">Docentes</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="personal administrativo" id="dest_admin">
                                                <label class="form-check-label" for="dest_admin">Personal Administrativo</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="padres de familia" id="dest_padres">
                                                <label class="form-check-label" for="dest_padres">Padres de Familia</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="comunicadoImagen" class="form-label">Imagen (URL)</label>
                                            <input type="text" class="form-control" id="comunicadoImagen" placeholder="images/comunicados/comunicado.jpg">
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="comunicadoActivo" checked>
                                            <label class="form-check-label" for="comunicadoActivo">Activo</label>
                                        </div>
                                        <div class="d-grid gap-2 mt-3">
                                            <button type="submit" class="btn btn-info">
                                                <i class="fas fa-save me-2"></i>Guardar Comunicado
                                            </button>
                                            <button type="button" class="btn btn-secondary" onclick="clearComunicadoForm()">
                                                <i class="fas fa-broom me-2"></i>Limpiar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-list me-2"></i>Comunicados Existentes
                                    </h6>
                                    <button class="btn btn-sm btn-outline-info" onclick="refreshComunicadosList()">
                                        <i class="fas fa-sync-alt"></i> Actualizar
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div id="comunicadosContainer" class="table-responsive">
                                        <div class="text-center p-4">
                                            <div class="spinner-border text-info" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-2">Cargando comunicados...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalles de Egresado -->
    <div class="modal fade" id="egresadoDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-user-graduate me-2"></i>
                        Detalles del Egresado
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="egresado-detail-content">
                    <!-- Se llenar√° din√°micamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/stats-counter.js?v=20251001"></script>
    <script src="js/cms-manager.js?v=20251001"></script>
    <script src="js/icon-check.js?v=20251001"></script>

    <!-- Script de inicializaci√≥n manual -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [INIT] Inicializando dashboard...');

            // Forzar actualizaci√≥n de estad√≠sticas despu√©s de un breve delay
            setTimeout(function() {
                if (window.statsCounter) {
                    console.log('üìä [INIT] Actualizando estad√≠sticas manualmente...');
                    window.statsCounter.refresh();
                } else {
                    console.warn('‚ö†Ô∏è [INIT] statsCounter no disponible, creando nuevo...');
                    window.statsCounter = new StatsCounter();
                }
            }, 2000);

            // Actualizar tambi√©n cuando se haga clic en "Actualizar estad√≠sticas"
            const refreshButton = document.querySelector('button[onclick="refreshStats()"]');
            if (refreshButton) {
                refreshButton.addEventListener('click', function() {
                    if (window.statsCounter) {
                        window.statsCounter.refresh();
                    }
                });
            }
        });

        // Funci√≥n global mejorada para refrescar estad√≠sticas
        function refreshStats() {
            console.log('üîÑ [MANUAL] Refrescando estad√≠sticas manualmente...');
            if (window.statsCounter) {
                window.statsCounter.refresh();
            } else {
                console.log('üìä [MANUAL] Creando nuevo contador de estad√≠sticas...');
                window.statsCounter = new StatsCounter();
            }
        }

        // Funci√≥n para ver contenido por tipo
        function viewContentType(type) {
            console.log('üìÑ [VIEW] Visualizando contenido de tipo:', type);

            // Remover clase active de todos los botones
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                if (btn.id && btn.id.startsWith('btnView')) {
                    btn.classList.remove('active');
                }
            });

            // Agregar clase active al bot√≥n clickeado
            const activeButton = document.getElementById(`btnView${type.charAt(0).toUpperCase() + type.slice(1)}`);
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // Mostrar contenido seg√∫n el tipo
            displayContentByType(type);
        }

        // Funci√≥n para mostrar contenido por tipo
        async function displayContentByType(type) {
            const container = document.getElementById('contentList');
            if (!container) {
                console.warn('‚ö†Ô∏è [VIEW] Contenedor contentList no encontrado');
                return;
            }

            container.innerHTML = `
                <div class="text-center p-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2">Cargando ${type}...</p>
                </div>
            `;

            try {
                let data = [];
                const endpoint = `${type}.json`;

                const response = await fetch(`data/${endpoint}`);
                if (response.ok) {
                    const jsonData = await response.json();
                    data = jsonData[type] || [];
                }

                if (data.length === 0) {
                    container.innerHTML = `
                        <div class="text-center p-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No hay ${type} disponibles</h5>
                            <p class="text-muted">Usa el formulario para crear nuevo contenido.</p>
                        </div>
                    `;
                    return;
                }

                // Mostrar tabla con el contenido
                let tableHTML = `
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>T√≠tulo</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                data.forEach(item => {
                    const fecha = item.fecha || item.fechaEmision || item.fechaInicio || 'N/A';
                    const estado = item.activo ? 'Activo' : 'Inactivo';
                    const estadoClass = item.activo ? 'bg-success' : 'bg-danger';

                    tableHTML += `
                        <tr>
                            <td>
                                <strong>${item.titulo}</strong>
                                ${item.destacado ? '<span class="badge bg-warning ms-2">Destacado</span>' : ''}
                            </td>
                            <td>${fecha}</td>
                            <td><span class="badge ${estadoClass}">${estado}</span></td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-outline-primary" onclick="editContent('${type}', '${item.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteContent('${type}', '${item.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                tableHTML += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = tableHTML;
                console.log(`‚úÖ [VIEW] ${data.length} elementos de ${type} mostrados`);

            } catch (error) {
                console.error(`‚ùå [VIEW] Error cargando ${type}:`, error);
                container.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Error cargando ${type}. Por favor, intenta de nuevo.
                    </div>
                `;
            }
        }

        // Funciones para editar y eliminar - Integradas con sistemas din√°micos
        function editContent(type, id) {
            console.log(`üñäÔ∏è [EDIT] Editando ${type} con ID: ${id}`);

            // Dirigir a la funci√≥n correcta seg√∫n el tipo
            switch(type.toLowerCase()) {
                case 'teacher':
                case 'docente':
                    if (window.dynamicTeacherLoader) {
                        window.dynamicTeacherLoader.editTeacher(id);
                    } else {
                        console.error('‚ùå Sistema de docentes no disponible');
                        alert('Sistema de gesti√≥n de docentes no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                case 'student':
                case 'estudiante':
                    if (window.dynamicStudentLoader) {
                        window.dynamicStudentLoader.editStudent(id);
                    } else {
                        console.error('‚ùå Sistema de estudiantes no disponible');
                        alert('Sistema de gesti√≥n de estudiantes no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                case 'finance':
                case 'finanza':
                case 'ingreso':
                    if (window.dynamicFinanceLoader) {
                        window.dynamicFinanceLoader.editIncome(id);
                    } else {
                        console.error('‚ùå Sistema de finanzas no disponible');
                        alert('Sistema de gesti√≥n de finanzas no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                case 'gasto':
                case 'expense':
                    if (window.dynamicFinanceLoader) {
                        window.dynamicFinanceLoader.editExpense(id);
                    } else {
                        console.error('‚ùå Sistema de finanzas no disponible');
                        alert('Sistema de gesti√≥n de finanzas no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                default:
                    console.warn(`‚ö†Ô∏è Tipo de contenido no reconocido: ${type}`);
                    alert(`Funci√≥n de edici√≥n para ${type} ser√° implementada pr√≥ximamente.`);
            }
        }

        function deleteContent(type, id) {
            if (!confirm(`¬øEst√°s seguro de que deseas eliminar este ${type}?`)) {
                return;
            }

            console.log(`üóëÔ∏è [DELETE] Eliminando ${type} con ID: ${id}`);

            // Dirigir a la funci√≥n correcta seg√∫n el tipo
            switch(type.toLowerCase()) {
                case 'teacher':
                case 'docente':
                    if (window.dynamicTeacherLoader) {
                        window.dynamicTeacherLoader.deleteTeacher(id);
                    } else {
                        console.error('‚ùå Sistema de docentes no disponible');
                        alert('Sistema de gesti√≥n de docentes no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                case 'student':
                case 'estudiante':
                    if (window.dynamicStudentLoader) {
                        window.dynamicStudentLoader.deleteStudent(id);
                    } else {
                        console.error('‚ùå Sistema de estudiantes no disponible');
                        alert('Sistema de gesti√≥n de estudiantes no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                case 'finance':
                case 'finanza':
                case 'ingreso':
                    if (window.dynamicFinanceLoader) {
                        window.dynamicFinanceLoader.deleteIncome(id);
                    } else {
                        console.error('‚ùå Sistema de finanzas no disponible');
                        alert('Sistema de gesti√≥n de finanzas no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                case 'gasto':
                case 'expense':
                    if (window.dynamicFinanceLoader) {
                        window.dynamicFinanceLoader.deleteExpense(id);
                    } else {
                        console.error('‚ùå Sistema de finanzas no disponible');
                        alert('Sistema de gesti√≥n de finanzas no est√° disponible. Recarga la p√°gina.');
                    }
                    break;

                default:
                    console.warn(`‚ö†Ô∏è Tipo de contenido no reconocido: ${type}`);
                    alert(`Funci√≥n de eliminaci√≥n para ${type} ser√° implementada pr√≥ximamente.`);
            }
        }

        // ‚úÖ FUNCIONES PARA GESTI√ìN DE CONTENIDO
        function showCreateNoticiaModal() {
            console.log('üì∞ Mostrando modal para crear noticia...');
            alert('Modal de creaci√≥n de noticias ser√° implementado pr√≥ximamente.');
        }

        function showCreateEventoModal() {
            console.log('üìÖ Mostrando modal para crear evento...');
            alert('Modal de creaci√≥n de eventos ser√° implementado pr√≥ximamente.');
        }

        function showCreateAvisoModal() {
            console.log('üì¢ Mostrando modal para crear aviso...');
            alert('Modal de creaci√≥n de avisos ser√° implementado pr√≥ximamente.');
        }

        function showCreateComunicadoModal() {
            console.log('üìã Mostrando modal para crear comunicado...');
            alert('Modal de creaci√≥n de comunicados ser√° implementado pr√≥ximamente.');
        }

        // ‚úÖ FUNCIONES TEMPORALES PARA FINANZAS (hasta que se implementen en dynamicFinanceLoader)
        function showEditIncomeModal(id) {
            console.log('üí∞ Mostrando modal para editar ingreso ID:', id);
            alert('Modal de edici√≥n de ingresos ser√° implementado pr√≥ximamente.');
        }

        function showEditExpenseModal(id) {
            console.log('üí∏ Mostrando modal para editar gasto ID:', id);
            alert('Modal de edici√≥n de gastos ser√° implementado pr√≥ximamente.');
        }

        // ‚úÖ FUNCI√ìN PARA GENERAR REPORTES
        function generateReport(type) {
            console.log('üìÑ [REPORTS] Generando reporte de tipo:', type);

            const reportTypes = {
                'academic': {
                    title: 'Reporte de Calificaciones',
                    icon: 'fas fa-graduation-cap',
                    description: 'Reporte acad√©mico completo con calificaciones por materia, promedio general y an√°lisis de rendimiento.',
                    data: 'Datos de ejemplo:\n‚Ä¢ Matem√°ticas: 8.5\n‚Ä¢ Espa√±ol: 9.2\n‚Ä¢ Ciencias: 7.8\n‚Ä¢ Historia: 8.9\n‚Ä¢ Promedio general: 8.6'
                },
                'attendance': {
                    title: 'Reporte de Asistencia',
                    icon: 'fas fa-calendar-check',
                    description: 'Control de asistencia mensual y estad√≠sticas de puntualidad.',
                    data: 'Estad√≠sticas:\n‚Ä¢ Asistencia total: 95.2%\n‚Ä¢ Faltas justificadas: 3.1%\n‚Ä¢ Retardos: 1.7%\n‚Ä¢ D√≠as totales: 180'
                },
                'performance': {
                    title: 'An√°lisis de Rendimiento',
                    icon: 'fas fa-chart-bar',
                    description: 'An√°lisis detallado del rendimiento acad√©mico y tendencias de mejora.',
                    data: 'An√°lisis:\n‚Ä¢ Tendencia: Mejora constante\n‚Ä¢ Materias destacadas: Espa√±ol, Historia\n‚Ä¢ √Åreas de oportunidad: Matem√°ticas\n‚Ä¢ Recomendaciones: Apoyo en matem√°ticas'
                },
                'payments': {
                    title: 'Estado de Pagos',
                    icon: 'fas fa-credit-card',
                    description: 'Reporte financiero de pagos realizados y pendientes.',
                    data: 'Estado financiero:\n‚Ä¢ Pagos al d√≠a: $12,500\n‚Ä¢ Pagos pendientes: $2,300\n‚Ä¢ Pr√≥ximo vencimiento: 15 de octubre\n‚Ä¢ Estado: Al corriente'
                },
                'income': {
                    title: 'Ingresos Mensuales',
                    icon: 'fas fa-chart-line',
                    description: 'Reporte de ingresos institucionales por mes.',
                    data: 'Ingresos:\n‚Ä¢ Septiembre 2024: $125,400\n‚Ä¢ Agosto 2024: $118,200\n‚Ä¢ Julio 2024: $112,800\n‚Ä¢ Tendencia: +8.5% mensual'
                },
                'pending': {
                    title: 'Pagos Vencidos',
                    icon: 'fas fa-exclamation-triangle',
                    description: 'Listado de pagos vencidos que requieren atenci√≥n.',
                    data: 'Alertas:\n‚Ä¢ 12 estudiantes con pagos vencidos\n‚Ä¢ Monto total: $18,400\n‚Ä¢ Promedio de d√≠as vencido: 15\n‚Ä¢ Acci√≥n requerida: Seguimiento'
                }
            };

            const report = reportTypes[type];
            if (!report) {
                alert('Tipo de reporte no reconocido: ' + type);
                return;
            }

            // Crear modal din√°mico para mostrar el reporte
            const reportModal = document.createElement('div');
            reportModal.className = 'modal fade';
            reportModal.id = 'reportModal';
            reportModal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title">
                                <i class="${report.icon} me-2"></i>${report.title}
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info">
                                <strong>Descripci√≥n:</strong> ${report.description}
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">üìä Datos del Reporte</h6>
                                </div>
                                <div class="card-body">
                                    <pre class="mb-0">${report.data}</pre>
                                </div>
                            </div>
                            <div class="alert alert-warning mt-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Nota:</strong> Este es un ejemplo de reporte. En la versi√≥n completa del sistema,
                                estos datos se generar√≠an din√°micamente desde la base de datos.
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i>Cerrar
                            </button>
                            <button type="button" class="btn btn-primary" onclick="downloadReport('${type}')">
                                <i class="fas fa-download me-2"></i>Descargar PDF
                            </button>
                            <button type="button" class="btn btn-success" onclick="exportReport('${type}')">
                                <i class="fas fa-file-excel me-2"></i>Exportar Excel
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Remover modal existente si existe
            const existingModal = document.getElementById('reportModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Agregar nuevo modal
            document.body.appendChild(reportModal);
            const modalInstance = new bootstrap.Modal(reportModal);
            modalInstance.show();

            // Limpiar modal cuando se cierre
            reportModal.addEventListener('hidden.bs.modal', function () {
                reportModal.remove();
            });
        }

        // ‚úÖ FUNCI√ìN PARA DESCARGAR REPORTES
        function downloadReport(type) {
            console.log('üì• [DOWNLOAD] Descargando reporte PDF:', type);
            alert(`üìÑ Descargando reporte "${type}" en formato PDF...\n\nEn la versi√≥n completa, esto generar√≠a un archivo PDF real con los datos actuales del sistema.`);
        }

        // ‚úÖ FUNCI√ìN PARA EXPORTAR REPORTES
        function exportReport(type) {
            console.log('üìä [EXPORT] Exportando reporte Excel:', type);
            alert(`üìä Exportando reporte "${type}" en formato Excel...\n\nEn la versi√≥n completa, esto generar√≠a un archivo Excel real con los datos actuales del sistema.`);
        }

        // ‚úÖ INICIALIZACI√ìN DEL DASHBOARD ADMINISTRATIVO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ [DASHBOARD] Inicializando AdminDashboard...');

            // Funci√≥n para inicializar el dashboard
            function initializeDashboard() {
                console.log('üîß [DASHBOARD] Creando instancia de AdminDashboard...');

                if (typeof AdminDashboard === 'undefined') {
                    console.error('‚ùå [DASHBOARD] AdminDashboard no est√° definido');
                    return false;
                }

                try {
                    window.adminDashboard = new AdminDashboard();
                    console.log('‚úÖ [DASHBOARD] AdminDashboard inicializado correctamente');
                    return true;
                } catch (error) {
                    console.error('‚ùå [DASHBOARD] Error al inicializar AdminDashboard:', error);
                    return false;
                }
            }

            // Funci√≥n para inicializar los gr√°ficos
            function initializeCharts() {
                console.log('üìä [CHARTS] Verificando Chart.js...');

                if (typeof Chart === 'undefined') {
                    console.error('‚ùå [CHARTS] Chart.js no est√° disponible');
                    return false;
                }

                console.log('üìä [CHARTS] Chart.js disponible, versi√≥n:', Chart.version);

                if (!window.adminDashboard) {
                    console.error('‚ùå [CHARTS] AdminDashboard no est√° inicializado');
                    return false;
                }

                try {
                    const canvas = document.getElementById('academicChart');
                    if (!canvas) {
                        console.error('‚ùå [CHARTS] Canvas academicChart no encontrado');
                        return false;
                    }
                    console.log('‚úÖ [CHARTS] Canvas encontrado:', canvas);

                    window.adminDashboard.createAcademicChart();
                    console.log('‚úÖ [CHARTS] Gr√°fico acad√©mico creado exitosamente');
                    return true;
                } catch (error) {
                    console.error('‚ùå [CHARTS] Error al crear gr√°fico:', error);
                    return false;
                }
            }

            // Funci√≥n para inicializar los event listeners de los tabs
            function initializeTabListeners() {
                console.log('üìë [TABS] Inicializando event listeners de tabs...');

                // Event listener para tab Estudiantes
                const studentsTab = document.getElementById('students-tab');
                if (studentsTab) {
                    studentsTab.addEventListener('shown.bs.tab', function () {
                        console.log('üë®‚Äçüéì [TAB] Cargando tabla de estudiantes...');
                        if (window.adminDashboard && typeof window.adminDashboard.loadStudentsTable === 'function') {
                            window.adminDashboard.loadStudentsTable();
                        } else {
                            console.error('‚ùå [TAB] loadStudentsTable no disponible');
                        }
                    });
                    console.log('‚úÖ [TABS] Listener de estudiantes agregado');
                } else {
                    console.warn('‚ö†Ô∏è [TABS] Tab students-tab no encontrado');
                }

                // Event listener para tab Docentes
                const teachersTab = document.getElementById('teachers-tab');
                if (teachersTab) {
                    teachersTab.addEventListener('shown.bs.tab', function () {
                        console.log('üë®‚Äçüè´ [TAB] Cargando tabla de docentes...');
                        if (window.adminDashboard && typeof window.adminDashboard.loadTeachersTable === 'function') {
                            window.adminDashboard.loadTeachersTable();
                        } else {
                            console.error('‚ùå [TAB] loadTeachersTable no disponible');
                        }
                    });
                    console.log('‚úÖ [TABS] Listener de docentes agregado');
                } else {
                    console.warn('‚ö†Ô∏è [TABS] Tab teachers-tab no encontrado');
                }

                // Event listener para tab Solicitudes
                const registrationsTab = document.getElementById('registrations-tab');
                if (registrationsTab) {
                    registrationsTab.addEventListener('shown.bs.tab', function () {
                        console.log('üìã [TAB] Cargando solicitudes pendientes...');
                        if (window.adminDashboard && typeof window.adminDashboard.displayPendingRegistrations === 'function') {
                            window.adminDashboard.displayPendingRegistrations();
                        } else {
                            console.error('‚ùå [TAB] displayPendingRegistrations no disponible');
                        }
                    });
                    console.log('‚úÖ [TABS] Listener de solicitudes agregado');
                } else {
                    console.warn('‚ö†Ô∏è [TABS] Tab registrations-tab no encontrado');
                }

                // Event listener para tab Usuarios Activos
                const activeUsersTab = document.getElementById('activeusers-tab');
                if (activeUsersTab) {
                    activeUsersTab.addEventListener('shown.bs.tab', function () {
                        console.log('üë• [TAB] Cargando usuarios activos...');
                        if (window.adminDashboard && typeof window.adminDashboard.loadActiveUsers === 'function') {
                            window.adminDashboard.loadActiveUsers();
                        } else {
                            console.error('‚ùå [TAB] loadActiveUsers no disponible');
                        }
                    });
                    console.log('‚úÖ [TABS] Listener de usuarios activos agregado');
                } else {
                    console.warn('‚ö†Ô∏è [TABS] Tab activeusers-tab no encontrado');
                }

                console.log('‚úÖ [TABS] Todos los listeners de tabs inicializados');
            }

            // Secuencia de inicializaci√≥n
            console.log('üîÑ [INIT] Iniciando secuencia de inicializaci√≥n...');

            // Paso 1: Verificar que AdminDashboard est√© definido
            if (typeof AdminDashboard === 'undefined') {
                console.warn('‚ö†Ô∏è [INIT] AdminDashboard a√∫n no est√° definido, esperando 1 segundo...');
                setTimeout(() => {
                    if (initializeDashboard()) {
                        initializeTabListeners();
                        // Dar tiempo para que Chart.js cargue
                        setTimeout(() => {
                            initializeCharts();
                        }, 500);
                    }
                }, 1000);
                return;
            }

            // Paso 2: Inicializar AdminDashboard
            if (!initializeDashboard()) {
                console.error('‚ùå [INIT] No se pudo inicializar el dashboard');
                return;
            }

            // Paso 3: Inicializar listeners de tabs
            initializeTabListeners();

            // Paso 4: Inicializar gr√°ficos (con delay para Chart.js)
            if (typeof Chart !== 'undefined') {
                console.log('‚úÖ [INIT] Chart.js ya disponible, creando gr√°ficos...');
                setTimeout(() => {
                    initializeCharts();
                }, 500);
            } else {
                console.warn('‚ö†Ô∏è [INIT] Chart.js no disponible, esperando 1.5 segundos...');
                setTimeout(() => {
                    if (!initializeCharts()) {
                        // Segundo intento despu√©s de 2 segundos m√°s
                        console.warn('‚ö†Ô∏è [INIT] Primer intento fallido, reintentando en 2 segundos...');
                        setTimeout(() => {
                            initializeCharts();
                        }, 2000);
                    }
                }, 1500);
            }

            console.log('‚úÖ [INIT] Secuencia de inicializaci√≥n completada');
        });

        // ‚úÖ FUNCIONES FALTANTES PARA BOTONES DEL DASHBOARD

        // Funci√≥n para panel de gesti√≥n de notificaciones
        window.openNotificationPanel = function() {
            console.log('üîî [NOTIFICATIONS] Abriendo panel de gesti√≥n de notificaciones...');

            const notificationModal = document.createElement('div');
            notificationModal.className = 'modal fade';
            notificationModal.id = 'notificationManagementModal';
            notificationModal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-warning text-white">
                            <h5 class="modal-title">
                                <i class="fas fa-bell me-2"></i>Gesti√≥n de Notificaciones Push
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6><i class="fas fa-paper-plane me-2"></i>Enviar Notificaci√≥n</h6>
                                    <form id="notificationForm">
                                        <div class="mb-3">
                                            <label class="form-label">T√≠tulo</label>
                                            <input type="text" class="form-control" id="notificationTitle" placeholder="Ej: Recordatorio importante">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Mensaje</label>
                                            <textarea class="form-control" id="notificationMessage" rows="3" placeholder="Escribe tu mensaje aqu√≠..."></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Destinatarios</label>
                                            <select class="form-select" id="notificationTargets">
                                                <option value="all">Todos los usuarios</option>
                                                <option value="students">Solo estudiantes</option>
                                                <option value="parents">Solo padres</option>
                                                <option value="teachers">Solo docentes</option>
                                            </select>
                                        </div>
                                        <button type="button" class="btn btn-warning" onclick="sendNotification()">
                                            <i class="fas fa-send me-2"></i>Enviar Ahora
                                        </button>
                                    </form>
                                </div>
                                <div class="col-md-6">
                                    <h6><i class="fas fa-history me-2"></i>Notificaciones Recientes</h6>
                                    <div class="list-group">
                                        <div class="list-group-item">
                                            <strong>Inicio de clases</strong>
                                            <br><small class="text-muted">Enviado hace 2 horas - 1,247 usuarios</small>
                                        </div>
                                        <div class="list-group-item">
                                            <strong>Recordatorio de pagos</strong>
                                            <br><small class="text-muted">Enviado ayer - 156 padres</small>
                                        </div>
                                        <div class="list-group-item">
                                            <strong>Reuni√≥n docentes</strong>
                                            <br><small class="text-muted">Enviado hace 3 d√≠as - 68 docentes</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Remover modal existente si existe
            const existingModal = document.getElementById('notificationManagementModal');
            if (existingModal) existingModal.remove();

            // Agregar y mostrar modal
            document.body.appendChild(notificationModal);
            const modalInstance = new bootstrap.Modal(notificationModal);
            modalInstance.show();

            // Limpiar cuando se cierre
            notificationModal.addEventListener('hidden.bs.modal', function() {
                notificationModal.remove();
            });
        }

        // Funci√≥n para enviar notificaci√≥n
        window.sendNotification = function() {
            const title = document.getElementById('notificationTitle').value;
            const message = document.getElementById('notificationMessage').value;
            const targets = document.getElementById('notificationTargets').value;

            if (!title || !message) {
                alert('‚ö†Ô∏è Por favor completa el t√≠tulo y mensaje de la notificaci√≥n');
                return;
            }

            console.log('üì§ [NOTIFICATION] Enviando notificaci√≥n:', { title, message, targets });

            // Simular env√≠o exitoso
            alert(`‚úÖ Notificaci√≥n enviada exitosamente!\n\nT√≠tulo: ${title}\nDestinatarios: ${targets}\n\nEn la versi√≥n completa, esto enviar√≠a una notificaci√≥n push real a los dispositivos de los usuarios.`);

            // Limpiar formulario
            document.getElementById('notificationTitle').value = '';
            document.getElementById('notificationMessage').value = '';

            // Cerrar modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('notificationManagementModal'));
            modal.hide();
        }

        // Funci√≥n para configurar estad√≠sticas (bot√≥n "Configurar Estad√≠sticas")
        window.openStatsConfiguration = function() {
            console.log('‚öôÔ∏è [STATS] Abriendo configuraci√≥n de estad√≠sticas...');

            // Buscar el modal existente y abrirlo
            const existingModal = document.getElementById('statisticsConfigModal');
            if (existingModal) {
                const modalInstance = new bootstrap.Modal(existingModal);
                modalInstance.show();
            } else {
                alert('‚ö†Ô∏è Modal de configuraci√≥n de estad√≠sticas no encontrado en el DOM');
            }
        }

        // Funci√≥n para abrir sistema de pagos
        window.openPaymentSystem = function() {
            console.log('üí∞ [PAYMENTS] Abriendo sistema de pagos...');
            alert('üí≥ Sistema de Pagos\n\nEsta funcionalidad conectar√≠a con:\n‚Ä¢ Registro de pagos\n‚Ä¢ Control de vencimientos\n‚Ä¢ Alertas autom√°ticas\n‚Ä¢ Comunicados a padres\n‚Ä¢ Reportes financieros\n\nEn desarrollo para la pr√≥xima versi√≥n.');
        }

        // Funci√≥n para calendario acad√©mico
        window.openAcademicCalendar = function() {
            console.log('üìÖ [CALENDAR] Abriendo calendario acad√©mico...');
            alert('üìÖ Calendario Acad√©mico\n\nFuncionalidades incluidas:\n‚Ä¢ Planificaci√≥n de eventos\n‚Ä¢ Fechas de ex√°menes\n‚Ä¢ Per√≠odos vacacionales\n‚Ä¢ Notificaciones autom√°ticas\n‚Ä¢ Eventos importantes\n\nSistema en desarrollo.');
        }

        // Funci√≥n para configuraci√≥n del sistema
        window.openSystemConfiguration = function() {
            console.log('‚öôÔ∏è [CONFIG] Abriendo configuraci√≥n del sistema...');
            alert('üîß Configuraci√≥n del Sistema\n\nOpciones disponibles:\n‚Ä¢ Configuraci√≥n institucional\n‚Ä¢ Personalizaci√≥n de reportes\n‚Ä¢ Gesti√≥n de usuarios\n‚Ä¢ Respaldos autom√°ticos\n\nPanel de administraci√≥n avanzado en construcci√≥n.');
        }

        // ‚úÖ FUNCIONES ADICIONALES PARA EL DASHBOARD

        // Funci√≥n para hacer login de admin
        window.loginAdmin = function() {
            console.log('üîê [LOGIN] Iniciando proceso de login...');
            // Esta funci√≥n debe delegar al sistema de autenticaci√≥n existente
            if (typeof handleAdminLogin === 'function') {
                handleAdminLogin();
            } else {
                console.warn('‚ö†Ô∏è handleAdminLogin no est√° disponible');
            }
        }

        // Funci√≥n para logout del admin
        window.logoutAdmin = function() {
            console.log('üëã [LOGOUT] Cerrando sesi√≥n...');
            if (typeof window.secureAdminAuth !== 'undefined' && typeof window.secureAdminAuth.logout === 'function') {
                window.secureAdminAuth.logout();
                window.location.href = 'index.html';
            } else {
                console.warn('‚ö†Ô∏è Sistema de autenticaci√≥n no disponible');
            }
        }

        // Funci√≥n para refrescar el dashboard
        window.refreshDashboard = function() {
            console.log('üîÑ [REFRESH] Refrescando dashboard...');
            location.reload();
        }

        // Funci√≥n para recargar estudiantes
        window.reloadStudents = function() {
            console.log('üë®‚Äçüéì [STUDENTS] Recargando lista de estudiantes...');
            if (typeof window.dynamicStudentLoader !== 'undefined' && typeof window.dynamicStudentLoader.loadStudents === 'function') {
                window.dynamicStudentLoader.loadStudents();
            } else {
                alert('‚ö†Ô∏è El cargador de estudiantes no est√° disponible');
            }
        }

        // Funci√≥n para recargar docentes
        window.reloadTeachers = function() {
            console.log('üë®‚Äçüè´ [TEACHERS] Recargando lista de docentes...');
            if (typeof window.dynamicTeacherLoader !== 'undefined' && typeof window.dynamicTeacherLoader.loadTeachers === 'function') {
                window.dynamicTeacherLoader.loadTeachers();
            } else {
                alert('‚ö†Ô∏è El cargador de docentes no est√° disponible');
            }
        }

        // Funciones para CMS
        window.showCreateNoticiaModal = function() { console.log('üì∞ Crear noticia'); alert('Modal de crear noticia (en desarrollo)'); }
        window.showCreateEventoModal = function() { console.log('üìÖ Crear evento'); alert('Modal de crear evento (en desarrollo)'); }
        window.showCreateAvisoModal = function() { console.log('‚ö†Ô∏è Crear aviso'); alert('Modal de crear aviso (en desarrollo)'); }
        window.showCreateComunicadoModal = function() { console.log('üìã Crear comunicado'); alert('Modal de crear comunicado (en desarrollo)'); }
        window.exportAllContent = function() { console.log('üì• Exportar contenido'); alert('Exportando contenido (en desarrollo)'); }
        window.refreshContentStats = function() { console.log('üîÑ Refrescar stats'); alert('Refrescando estad√≠sticas (en desarrollo)'); }
        window.showContentPreview = function() { console.log('üëÅÔ∏è Vista previa'); alert('Vista previa de contenido (en desarrollo)'); }
        window.clearNoticiaForm = function() { console.log('üóëÔ∏è Limpiar formulario noticia'); }
        window.refreshNoticiasList = function() { console.log('üîÑ Refrescar noticias'); }
        window.clearEventoForm = function() { console.log('üóëÔ∏è Limpiar formulario evento'); }
        window.refreshEventosList = function() { console.log('üîÑ Refrescar eventos'); }
        window.clearAvisoForm = function() { console.log('üóëÔ∏è Limpiar formulario aviso'); }
        window.refreshAvisosList = function() { console.log('üîÑ Refrescar avisos'); }
        window.clearComunicadoForm = function() { console.log('üóëÔ∏è Limpiar formulario comunicado'); }
        window.refreshComunicadosList = function() { console.log('üîÑ Refrescar comunicados'); }
        window.showReportsManager = function() { console.log('üìä Gestor de reportes'); alert('Gestor de reportes (en desarrollo)'); }

        // Funci√≥n para cambiar contrase√±a
        window.showChangePasswordModal = function() {
            console.log('üîë [PASSWORD] Abriendo modal de cambio de contrase√±a...');

            const passwordModal = document.createElement('div');
            passwordModal.className = 'modal fade';
            passwordModal.id = 'changePasswordModal';
            passwordModal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title">
                                <i class="fas fa-key me-2"></i>Cambiar Contrase√±a
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="changePasswordForm">
                                <div class="mb-3">
                                    <label class="form-label">Contrase√±a Actual</label>
                                    <input type="password" class="form-control" id="currentPassword" placeholder="Ingresa tu contrase√±a actual" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nueva Contrase√±a</label>
                                    <input type="password" class="form-control" id="newPassword" placeholder="M√≠nimo 8 caracteres" required minlength="8">
                                    <small class="text-muted">Debe contener al menos 8 caracteres</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Confirmar Nueva Contrase√±a</label>
                                    <input type="password" class="form-control" id="confirmPassword" placeholder="Repite la nueva contrase√±a" required>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" onclick="changePassword()">
                                <i class="fas fa-save me-2"></i>Cambiar Contrase√±a
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Remover modal existente si existe
            const existingModal = document.getElementById('changePasswordModal');
            if (existingModal) existingModal.remove();

            // Agregar y mostrar modal
            document.body.appendChild(passwordModal);
            const modalInstance = new bootstrap.Modal(passwordModal);
            modalInstance.show();

            // Limpiar cuando se cierre
            passwordModal.addEventListener('hidden.bs.modal', function() {
                passwordModal.remove();
            });
        }

        // Funci√≥n para ejecutar cambio de contrase√±a
        window.changePassword = function() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('‚ö†Ô∏è Por favor completa todos los campos');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('‚ö†Ô∏è Las contrase√±as no coinciden');
                return;
            }

            if (newPassword.length < 8) {
                alert('‚ö†Ô∏è La contrase√±a debe tener al menos 8 caracteres');
                return;
            }

            console.log('üîë [PASSWORD] Cambiando contrase√±a...');

            // Aqu√≠ ir√≠a la l√≥gica real de cambio de contrase√±a
            alert('‚úÖ Contrase√±a cambiada exitosamente!\n\nEn la versi√≥n completa, esto actualizar√≠a tu contrase√±a en el servidor.');

            // Cerrar modal
            bootstrap.Modal.getInstance(document.getElementById('changePasswordModal')).hide();
        }

        console.log('‚úÖ [DASHBOARD] Todas las funciones del dashboard cargadas correctamente');

    </script>
</body>
</html>